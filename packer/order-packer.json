{

  "variables": {
        "ssh_name": "root"
  },	

  "builders": [{
    "type": "digitalocean",
    "api_token": "e4561f1b44faa16c2b43e94c5685e5960e852326b921883765b3b0e11111f705",
    "region": "nyc3",
    "size": "512mb",
    "image": "ubuntu-16-04-x64",
    "ssh_username": "{{user `ssh_name`}}"  
  }],

  "provisioners": [
  
     {
        "type": "shell",
        "inline": [
           "sleep 30",
           "sudo apt-get update",
           "sudo apt-get install -y apache2"
         ]
     },
   
     {
        "type": "shell",
        "inline": [
           "sleep 30",	
	   "sudo apt-add-repository -y ppa:ondrej/php",
	   "sudo apt-get -y install php7.0 php5.6-mysql php5.6-cli php5.6-curl php5.6-json php5.6-sqlite3 php5.6-mcrypt php5.6-curl php-xdebug php5.6-mbstring libapache2-mod-php5.6 libapache2-mod-php7.0 mysql-server-5.7 apache2",	           
           "sudo a2dismod php7.0 ; sudo a2enmod php5.6 ; sudo service apache2 restart ; echo 1 | sudo update-alternatives --config php"
         ]     
      },

      {
        "type": "shell",
        "inline": [
           "sleep 30",	            
           "sudo apt-get install -y postgresql postgresql-contrib"
         ]    
      },

      {
        "type": "shell",
        "inline": [  
           "sudo apt-get install -y git",
           "ssh-keyscan github.com >> ~/.ssh/known_hosts",
           "cd /usr/local/bin/",
           "git clone https://github.com/victorbrodsky/order-lab.git",
           "sudo chmod a+x /usr/local/bin/order-lab",
           "chown -R www-data:www-data /usr/local/bin/order-lab",
           "curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer",
           "cd order-lab/Scanorders2/",
           "composer update",
           "deploy_prod"
         ]    
      } 	

     
  ]

}

