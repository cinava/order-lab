{% extends "OlegVacReqBundle::Default/base.html.twig" %}



{% block title %}
    Organizational Group Management for {{ organizationalGroupName }}
{% endblock %}



{% block content %}

    <h4 class="text-info" align="center">
        Organizational Group Management for {{ organizationalGroupName }}
    </h4>

    <br>

    <div class="panel panel-info">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" href="#vacreq-organizational-group-approver">
                    Approver(s)
                </a>
            </h4>
        </div>
        <div id="vacreq-organizational-group-approver" class="panel-collapse collapse in">
            <div class="panel-body">

                {% for approver in approvers %}
                    <div class="well">
                        {#{{ approver }}#}
                        {#({{ approver.getSiteRoles('APPROVER')|join(', ') }})#}
                        {#approver.id={{ approver.id }}#}
                        {#organizationalGroupId={{ organizationalGroupId }}#}
                        {#approverRoleId={{ approverRoleId }}#}
                        {{ render(controller('OlegVacReqBundle:Approver:userManagement', { 'userid': approver.id, 'instid':organizationalGroupId, 'roleId':approverRoleId})) }}
                    </div>
                {% endfor %}

                {#<form id="add_authorized_user_form" action="{{ path('vacreq_orginst_add_user',{'roleId':approverRoleId}) }}" method="GET">#}

                    {#{{ formmacros.field(form.keytype) }}#}
                    {#{{ formmacros.field(form.primaryPublicUserId) }}#}

                    {#<p>#}
                        {#<button type='submit' class="btn btn-info btn-sm">Add Approver</button>#}
                    {#</p>#}
                {#</form>#}
                <div class="well">
                    {{ render( url('vacreq_orginst_add_user',{'instid':organizationalGroupId,'roleId':approverRoleId,'btnName':'Add Approver(s)'})) }}
                </div>

            </div> <!-- panel-body -->
        </div> <!-- panel-collapse -->
    </div> <!-- panel panel-info -->


    <div class="panel panel-info">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" href="#vacreq-organizational-group-submitter">
                    Submitter(s)
                </a>
            </h4>
        </div>
        <div id="vacreq-organizational-group-submitter" class="panel-collapse collapse in">
            <div class="panel-body">

                {% for submitter in submitters %}
                    <div class="well">
                        {#{{ submitter }}#}
                        {#({{ approver.getSiteRoles('SUBMITTER')|join(', ') }})#}
                        {#the same as render(controller('OlegVacReqBundle:Approver:userManagement'#}
                        {{ render( url('vacreq_orginst_user_management',{'userid':submitter.id,'instid':organizationalGroupId, 'roleId':submitterRoleId}), {'default': 'OlegUserdirectoryBundle:Default:default-hinclude-content.html.twig'} ) }}
                    </div>
                {% endfor %}

                <div class="well">
                    {{ render( url('vacreq_orginst_add_user',{'instid':organizationalGroupId,'roleId':submitterRoleId,'btnName':'Add Submitter(s)'})) }}
                </div>

            </div> <!-- panel-body -->
        </div> <!-- panel-collapse -->
    </div> <!-- panel panel-info -->


    <div class="panel panel-info">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" href="#vacreq-organizational-group-emails">
                    Confirmation Email List
                </a>
            </h4>
        </div>
        <div id="vacreq-organizational-group-emails" class="panel-collapse collapse in">
            <div class="panel-body">

                <div class="well">
                    {{ render( url('vacreq_orginst_emailusers',{'instid':organizationalGroupId})) }}
                </div>

            </div> <!-- panel-body -->
        </div> <!-- panel-collapse -->
    </div> <!-- panel panel-info -->



    <br>
    {#<p>#}
        {#<a class="btn-sm btn-danger" href="#">Update</a>#}
    {#</p>#}
    {% if is_granted('ROLE_VACREQ_ADMIN') %}
        <p>
            <a
                general-data-confirm="Are you sure you want to remove this organizational group by removing approver and submiiter roles?"
                class="btn-sm btn-danger" href="{{ path('vacreq_group_remove',{'instid':organizationalGroupId}) }}"
            >
                Delete Group
            </a>
        </p>
    {% endif %}

    <br>

{% endblock %}



{% block additionaljs %}

    <script>

        $(document).ready(function() {


        });

        function updateVacReqGroupUser(btn,userid,instid,roleId) {
            var formid = "vacreq_orginst_user_management_"+userid+"_"+roleId;
            //console.log('formid='+formid);

            var form = $('#'+formid);

            //get roles by class vacreq-roles
            var roles = form.find('.vacreq-roles').select2('val');
            //console.log('roles='+roles);

            if( !roles || roles == '' ) {
                roles = 0;
            }

            var updateUserUrl = Routing.generate('vacreq_orginst_user_update', {userid: userid, instid:instid, roleIds:roles});
            //console.log('updateUserUrl='+updateUserUrl);

            //$('#'+formid).submit();
            $.get(updateUserUrl, function(data, status){
                //console.log("Data: " + data + "\nStatus: " + status);
                if( status == "success" ) {
                    //reload page
                    location.reload();
                }
            });
        }

        function updateVacReqGroupEmailUsers(btn,instid) {
            var formid = "vacreq_orginst_emailusers";
            //console.log('formid='+formid);

            var form = $('#'+formid);

            //get roles by class vacreq-roles
            var users = form.find('.vacreq-emailusers').select2('val');
            //console.log('users='+users);

            if( !users || users == '' ) {
                users = 0;
            }

            var updateUserUrl = Routing.generate('vacreq_orginst_emailusers_update', {instid:instid,users:users});
            //console.log('updateUserUrl='+updateUserUrl);

            //$('#'+formid).submit();
            $.get(updateUserUrl, function(data, status){
                //console.log("Data: " + data + "\nStatus: " + status);
                if( status == "success" ) {
                    //reload page
                    location.reload();
                }
            });
        }

    </script>

{% endblock %}


