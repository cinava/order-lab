
{% import "OlegUserdirectoryBundle::Default/usermacros.html.twig" as usermacros %}
{% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}
{% import _self as fellapp %}



{% set trclassname = "well well-sm" %}
{% if entity.appStatus %}
{% if entity.appStatus.name == 'archive' %}
    {% set trclassname = "alert alert-info" %}
{% endif %}
{% if entity.appStatus.name == 'hide' %}
    {% set trclassname = "alert alert-danger" %}
{% endif %}
{% if entity.appStatus.name == 'complete' %}
    {% set trclassname = "alert order-neutral-status" %}
{% endif %}
{% if entity.appStatus.name == 'active' %}
    {#{% set trclassname = "alert order-neutral-status" %}#}
{% endif %}
{% if entity.appStatus.name == 'interviewee' %}
    {% set trclassname = "order-interviewee-status" %}
{% endif %}
{% if entity.appStatus.name == 'reject' %}
    {% set trclassname = "order-reject-status" %}
{% endif %}
{% if entity.appStatus.name == 'onhold' %}
    {% set trclassname = "order-onhold-status" %}
{% endif %}
{% endif %}

{% if cycle != "new" %}
    <h4 class="text-info" align="center">
        <div class="{{ trclassname }}">
            {% if entity.appStatus %}
                <p>{{ entity.appStatus.action }}</p>
            {% endif %}
            Fellowship Application ID {{ entity.id }}, submitted on {{ entity.timestamp|date('m/d/Y H:i','UTC') }}, imported on {{ entity.createdate|date('m/d/Y H:i','UTC') }}
        </div>
    </h4>
{% endif %}

{% if cycle == "show" %}
    <p>
        <a class="btn btn-info" href="{{ path('fellapp_download_pdf', { 'id': entity.id}) }}">Download Application as a PDF</a>
    </p>
{% endif %}


{#user's snapshot#}
{{ fellapp.snapshot(entity,sitename,cycle) }}
<br>


{% if cycle != "download" %}
<p>
    <button id="collapseAll" type="button" class="btn btn-default btn-sm" onClick="collapseAll()" >Collapse All Application Sections</button>
    <button id="expandAll" type="button" class="btn btn-default btn-sm btn-pressed-default" onClick="extendAll()" >Expand All Application Sections</button>
</p>
<br>
{% endif %}



{{ form_start(form,{'attr': {'id': 'fellapp-applicant-form'}}) }}

{{ form_errors(form) }}


<div id="form-prototype-data"
     data-userurllink = "{{ usermacros.userUrlLink()|e }}"
     data-uploadurl = "{{ oneup_uploader_endpoint('employees_gallery') }}"
     data-userid = "{{ entity.user.id }}"
></div>

    <input type="hidden" id="fellapp_id" value="{{ entity.id }}" />
    <input type="hidden" id="user_id" value="{{ form.vars.value.user.id }}" />
    <input type="hidden" id="user_name" value="{{ form.vars.value.user.username }}" />
    <input type="hidden" id="formcycle" value="{{ cycle }}" />
    <input type="hidden" id="baseurl" value="{{app.request.host}}{{app.request.getBaseURL()}}" />

{% if form.timestamp is defined %}
    <div class="row">
        <div class="col-xs-4"></div>
        <div class="col-xs-4">
            {{ formmacros.fieldDateLabel_vertical(form.timestamp,'allow-future-date') }}
        </div>
        <div class="col-xs-4"></div>
    </div>
{% endif %}

<!-- Fellowship Type, Training period, Applicant Name -->
{% include 'OlegFellAppBundle:Form:FellowshipType.html.twig' %}

<!-- Personal Data -->
{% include 'OlegFellAppBundle:Form:PersonalData.html.twig' %}

<!-- Education -->
{% include 'OlegFellAppBundle:Form:Education.html.twig' %}

<!-- National Boards -->
{% include 'OlegFellAppBundle:Form:NationalBoards.html.twig' %}

<!-- MedicalLicensure -->
{% include 'OlegFellAppBundle:Form:MedicalLicensure.html.twig' %}

<!-- Board Certification -->
{% include 'OlegFellAppBundle:Form:BoardCertification.html.twig' %}

<!-- Recommendations -->
{% include 'OlegFellAppBundle:Form:Recommendations.html.twig' %}

<!-- Uploads -->
{% if cycle != "download" %}
    {% include 'OlegFellAppBundle:Form:Uploads.html.twig' %}
{% endif %}

<!-- Honors and Awards -->
{% include 'OlegFellAppBundle:Form:Honors.html.twig' %}

<!-- PDF Reports -->
{% if cycle != "download" and cycle != "new" %}
    {% include 'OlegFellAppBundle:Form:reportsPDF.html.twig' %}
{% endif %}

<!-- Itinerary -->
{% if cycle != "download" %}
    {% include 'OlegFellAppBundle:Form:Itinerary.html.twig' %}
{% endif %}

<!-- Signature -->
{% include 'OlegFellAppBundle:Form:Signature.html.twig' %}


{#{% do form.setRendered %}#}
{#{{ form_widget(form._token) }}#}

{#{{ form_row(form.submit) }}#}
{#{{ form_widget(form.update) }}#}

<div id="error-box" class="alert alert-danger" style="display: none"></div>

{% if cycle == "edit" %}
    <p>
        <button class="btn btn-warning" type="submit">Update</button>
        {#<a class="btn_margin_top btn btn-primary btn-warning" href="{{ path(fellapp_sitename~'_update',{'id':entity.id}) }}">Update</a>#}
        {#<button class="btn btn-warning" name="btnSubmit" type="submit" form="fellapp-applicant-form" onclick="updateFellapp({{ entity.id }})">Update</button>#}

        <a class="btn_margin_top btn btn-primary btn-success" href="{{ path(fellapp_sitename~'_show',{'id':entity.id}) }}">Cancel</a>
    </p>
{% endif %}

{% if cycle == "new" %}
    <p>
        {#<button class="btn btn-warning" type="submit">Add Applicant</button>#}
        <button class="btn btn-warning" name="btnSubmit" type="button" form="fellapp-applicant-form" onclick="validateFellapp()">Add Applicant</button>
    </p>
{% endif %}

{#{{ form_end(form) }}#}
{{ form_end(form, {'render_rest': false}) }}

<br>

{% if cycle == "show" %}
    <p>
        <a class="btn_margin_top btn btn-primary btn-success" href="{{ path(fellapp_sitename~'_edit',{'id':entity.id}) }}">Edit</a>
    </p>
{% endif %}

{#{% if cycle == "edit" %}#}
    {#<p>#}
        {#<button class="btn btn-warning" type="submit">Update</button>#}
        {#&#123;&#35;<a class="btn_margin_top btn btn-primary btn-warning" href="{{ path(fellapp_sitename~'_update',{'id':entity.id}) }}">Update</a>&#35;&#125;#}
        {#&#123;&#35;<button class="btn btn-warning" name="btnSubmit" type="submit" form="fellapp-applicant-form" onclick="updateFellapp({{ entity.id }})">Update</button>&#35;&#125;#}

        {#<a class="btn_margin_top btn btn-primary btn-success" href="{{ path(fellapp_sitename~'_show',{'id':entity.id}) }}">Cancel</a>#}
    {#</p>#}
{#{% endif %}#}





{% macro snapshot( fellapp, sitename, cycle ) %}

    {% import "OlegUserdirectoryBundle::Default/usermacros.html.twig" as usermacros %}

    <h1>{{ fellapp.user.getUsernameOptimal }}</h1>

    {#avatar#}
    <div align="center" style="height: 160px;">
        {#avatar form modal#}
        {% if fellapp.avatars|length > 0 %}
            {{ usermacros.showDocumentAsImage(fellapp.avatars|last,'Avatar','') }}
        {% else %}
            {% set avatarImage = asset('bundles/oleguserdirectory/fengyuanchen-image-cropper/img/Placeholder-User-Glyph-Icon.png') %}
            <img src="{{ avatarImage }}" alt="Avatar" style="max-width:100%; max-height:100%;">
        {% endif %}
    </div>


{% endmacro %}