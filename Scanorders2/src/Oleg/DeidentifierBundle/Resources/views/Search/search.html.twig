{% extends "OlegDeidentifierBundle::Default/base.html.twig" %}

{% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}


{% block title %}
    Deidentifier Search
{% endblock %}


{% block content %}

    <input type="hidden" id="orderformtype" value="deidentifier" />
    <input type="hidden" id="formcycle" value="new" />


    {% if pagination is defined and pagination is not null and pagination|length > 0 %}

        {#{% for accession in pagination  %}#}

            {#<div class="well">#}

                <table class="table table-hover table-condensed text-left">
                    <thead>
                    <tr>
                        {#<th>{{ knp_pagination_sortable(pagination, 'Status', 'accessionAccession.status') }}</th>#}
                        <th>{{ knp_pagination_sortable(pagination, 'Accession ID', 'accessionAccession.id') }}</th> {#fix for sort deidentifier number as string#}
                        <th>{{ knp_pagination_sortable(pagination, 'Accession Type', 'keytype.name') }}</th>
                        <th>{{ knp_pagination_sortable(pagination, 'Author', 'accessionAccession.provider') }}</th>
                        <th>{{ knp_pagination_sortable(pagination, 'Creation Date', 'accessionAccession.creationdate') }}</th>
                        <th>{{ knp_pagination_sortable(pagination, 'Organizational Group', 'institution.fulltitle') }}</th>

                        <th>{{ knp_pagination_sortable(pagination, 'Patient', 'lastname.field') }}</th>

                        {#<th>Type</th>#}
                        {#<th>Accession Number</th>#}
                        {#<th>Accession Type</th>#}
                        {#<th>Author</th>#}
                        {#<th>Creation Date</th>#}
                    </tr>
                    </thead>

                    <tbody>

                    {% for accessionAccession in pagination %}
                        <tr>
                            {#<td>{{ accessionAccession.status }}</td>#}
                            <td>{{ accessionAccession.field }}</td>
                            <td>{{ accessionAccession.keytype }}</td>
                            <td>{{ accessionAccession.provider }}</td>
                            <td>{{ accessionAccession.creationdate|date('m/d/Y H:i') }}</td>
                            <td>{{ accessionAccession.accession.institution.fulltitle }}</td>

                            <td>
                                {% if accessionAccession.accession.procedure.encounter.patient %}
                                    {{ accessionAccession.accession.procedure.encounter.patient.obtainFullObjectName|raw }}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}

                    </tbody>
                </table>

                {#generate#}
                {#<form action="{{ path('deidentifier_generate',{'accessionId':pagination|first.accession.id}) }}">#}
                    {#<button type="submit" class="btn btn-sm btn-primary">Generate a New Deidentifier</button>#}
                {#</form>#}

            {#</div>#}

        {#{% endfor %}#}

        <div class="navigation">
            {{ knp_pagination_render(pagination) }}
        </div>

    {% else %}

        <h4>
            No matching IDs found
        </h4>

    {% endif %}



{% endblock %}
