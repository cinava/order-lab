parameters:

    translationalresearch.sitename: translationalresearch
    transres.uploadpath:


twig:
    globals:
        translationalresearch_sitename: '%translationalresearch.sitename%'
        #service
#        translationalresearch_util: "@translationalresearch_util"


services:

    translationalresearch_authentication_handler:
        class: Oleg\TranslationalResearchBundle\Security\Authentication\TranslationalResearchLoginSuccessHandler
        arguments:  ["@service_container", "@doctrine.orm.entity_manager"]

    translationalresearch_role_voter:
        class: Oleg\TranslationalResearchBundle\Security\Voter\TranslationalResearchRoleVoter
        public: false
        arguments: ['@security.access.decision_manager', "@doctrine.orm.entity_manager", "@service_container"]
        tags:
            - { name: security.voter }

    translationalresearch_permission_voter:
        class: Oleg\TranslationalResearchBundle\Security\Voter\TranslationalResearchPermissionVoter
        public: false
        arguments: ['@security.access.decision_manager', "@doctrine.orm.entity_manager", "@service_container"]
        tags:
            - { name: security.voter }

    transres_util:
        class: Oleg\TranslationalResearchBundle\Util\TransResUtil
        arguments: ["@doctrine.orm.entity_manager", "@service_container"]

    transres_request_util:
        class: Oleg\TranslationalResearchBundle\Util\TransResRequestUtil
        arguments: ["@doctrine.orm.entity_manager", "@service_container"]

    transres_formnode_util:
        class: Oleg\TranslationalResearchBundle\Util\TransResFormNodeUtil
        arguments: ["@doctrine.orm.entity_manager", "@service_container"]


framework:
    workflows:
        transres_project:
            type: 'state_machine'
            marking_store:
                type: 'single_state' # 'multiple_state' or 'single_state'
                arguments:
                    - 'state' #state keeps the marking state
            supports:
                - Oleg\TranslationalResearchBundle\Entity\Project
            #Project has state which is equal to this place
            places:
                - start
                - draft
                - complete
                # irb
                - irb_review        #available for IRB review
#                - irb_approved     #approved by IRB review. Project goes to the next stage
                - irb_rejected      #rejected by IRB review. User can re-submit the project -resubmit_irb_rejected-> irb_review
                - irb_missinginfo   #Pending additional information from submitter - Request additional information from submitter
                # admin
                - admin_review
#                - admin_approved
                - admin_rejected
                - admin_missinginfo
                # committee
                - committee_review
#                - committee_approved
                - committee_rejected
                - committee_missinginfo
                # final
                - final_review
                - final_approved
                - final_rejected
                - final_missinginfo
                # closed
                - closed

            transitions:
                to_draft:
                    from: start
                    to: draft
                to_complete:
                    from: [start, draft]
                    to: complete
                to_review:
                    from: complete
                    to: irb_review

                ### Main Actions ###
                #IRB Review
                irb_review_approved:
                    from: irb_review
                    to: admin_review
                irb_review_rejected:
                    from: irb_review
                    to: irb_rejected
                irb_review_missinginfo:
                    from: irb_review
                    to: irb_missinginfo
                irb_review_resubmit:
                     from: irb_missinginfo
                     to: irb_review
                #ADMIN Review
                admin_review_approved:
                    from: admin_review
                    to: committee_review
                admin_review_rejected:
                    from: admin_review
                    to: admin_rejected
                admin_review_missinginfo:
                    from: admin_review
                    to: admin_missinginfo
                admin_review_resubmit:
                     from: admin_missinginfo
                     to: admin_review
                #COMMITTEE Review
                committee_review_approved:
                    from: committee_review
                    to: final_review
                committee_review_rejected:
                    from: committee_review
                    to: committee_rejected
                committee_review_missinginfo:
                    from: committee_review
                    to: committee_missinginfo
                committee_review_resubmit:
                     from: committee_missinginfo
                     to: committee_review
                #FINAL Review
                final_review_approved:
                    from: final_review
                    to: final_approved
                final_review_rejected:
                    from: final_review
                    to: final_rejected
                final_review_missinginfo:
                    from: final_review
                    to: final_missinginfo
                final_review_resubmit:
                     from: final_missinginfo
                     to: final_review

                #Closed
                approved_closed:
                    from: final_approved
                    to: closed
                #Un-Closed
                closed_approved:
                    from: closed
                    to: final_approved

        transres_request_billing:
            type: 'state_machine'
            marking_store:
                type: 'single_state' # 'multiple_state' or 'single_state'
                arguments:
                    - 'billingState' #state keeps the marking state
            supports:
                - Oleg\TranslationalResearchBundle\Entity\TransResRequest
            places:
                - draft
                - active
                - cancel
                - missinginfo
                - invoice
                - paid
                - refund
                - partially_refund

            transitions:
                draft_active:
                    from: draft
                    to: active
                active_cancel:
                    from: active
                    to: cancel
                cancel_active:
                    from: cancel
                    to: active
                active_invoice:
                    from: active
                    to: invoice
                active_missinginfo:
                    from: active
                    to: missinginfo
                invoice_paid:
                    from: invoice
                    to: paid
                invoice_refund:
                    from: invoice
                    to: refund
                invoice_partially_refund:
                     from: invoice
                     to: partially_refund

        transres_request_progress:
            type: 'state_machine'
            marking_store:
                type: 'single_state' # 'multiple_state' or 'single_state'
                arguments:
                    - 'progressState' #state keeps the marking state
            supports:
                - Oleg\TranslationalResearchBundle\Entity\TransResRequest
            places:
                - draft
                - active
                - cancel
                - pending
                - investigator
                - histo
                - ihc
                - mol
                - retrieval
                - payment
                - slidescanning
                - block
                - complet
                - suspend
            transitions:
                draft_active:
                    from: draft
                    to: active
                active_cancel:
                    from: active
                    to: cancel
                cancel_active:
                    from: cancel
                    to: active
                active_pending:
                    from: active
                    to: pending
                pending_investigator:
                    from: pending
                    to: investigator
                pending_histo:
                    from: pending
                    to: histo
                pending_ihc:
                    from: pending
                    to: ihc
                pending_mol:
                    from: pending
                    to: mol
                pending_retrieval:
                    from: pending
                    to: retrieval
                pending_payment:
                    from: pending
                    to: payment
                pending_slidescanning:
                    from: pending
                    to: slidescanning
                pending_block:
                    from: pending
                    to: block
                pending_complet:
                    from: pending
                    to: complet
                pending_suspend:
                    from: pending
                    to: suspend

