{% extends "OlegCallLogBundle::Default/base.html.twig" %}

{% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}
{% import "OlegUserdirectoryBundle::Default/usermacros.html.twig" as usermacros %}
{% import "OlegCallLogBundle::Default/calllogmacros.html.twig" as calllogmacros %}


{% block title %}
    {{ title }}
{% endblock %}


{% block content %}

    <h4 class="text-info calllog-title" align="center">
        {{ title }}
    </h4>
    <br>


    <input type="hidden" id="formcycle" value="{{ cycle }}" />
    <input type="hidden" id="orderformtype" value="calllog" />
    <input type="hidden" id="formtype" value="{{ formtype }}" />
    <input type="hidden" id="triggerSearch" value="{{ triggerSearch }}" />
    <input type="hidden" id="mrntype" value="{{ mrntype }}" />

    <div id="calllog-patient-list">

    {% if form1 is defined %}
        {{ calllogmacros.patientInfoSection(form1,cycle,'patient-holder-1','Patient Info',formtype) }}
    {% endif %}

    </div>


    <div id="calllog-msg-danger-box" class="alert alert-danger" style="display: none; margin-top: 5px; margin-bottom: 5px;"></div>
    <div id="calllog-msg-success-box" class="alert alert-success" style="display: none; margin-top: 5px; margin-bottom: 5px;"></div>

    <button
            id="submit_patient_button" type="button"
            class="btn btn-lg btn-success" align="center"
            onclick="submitPatientBtn('patient-holder-1')"
            style="display:none;"
    >
        Submit Patient Info
    </button>


{% endblock %}


{% block additionaljs %}
    <script language="Javascript">
        $(document).ready(function() {
            //hide all alias
            //calllogHideAllAlias(true,true);
            showHideSubmitPatientButton();
            calllogTriggerSearch();
        });

        //triggered by class calllog-patient-id
        function showHideSubmitPatientButton() {
            $('.calllog-patient-id').on('change', function() {
                //console.log('calllog-patient-id changed; value='+$(this).val());
                var counter = 0;
                var totalCounter = 0;
                $('.calllog-patient-id').each(function() {
                    if( $(this).val() ) {
                        counter++;
                    }
                    totalCounter++;
                });
                //console.log("counter="+counter+" ?= "+totalCounter);
                if( counter > 0 && counter == totalCounter ) {
                    $('#submit_patient_button').show();
                } else {
                    $('#submit_patient_button').hide();
                }
            });
        }

        //overwrite function
        matchingPatientBtnClick = function(holderId) {
            //console.log('un-merged holderId='+holderId);
            matchingPatientForEditBtnClick(holderId);
            calllogScrollToTop();
        }

    </script>
{% endblock %}
