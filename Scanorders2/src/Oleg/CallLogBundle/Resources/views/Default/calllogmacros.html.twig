{% macro simpleDateField(label,value,placeholder) %}

    <p>
    <div class="row">
        <div class="col-xs-6" align="right">
            <label>{{ label|raw }}</label>
        </div>
        <div class="col-xs-6" align="left" class="form_body_toggle_btn">
            <div class="input-group input-group-reg date allow-future-date">
                <input class="form-control form-control-modif not-mapped-simplefield" type="text" value="{{ value }}" placeholder="{{ placeholder }}">
                <span class="input-group-addon calendar-icon-button"><i class="glyphicon glyphicon-calendar"></i></span>
            </div>
        </div>
    </div>
    </p>

{% endmacro %}

{% macro singleDateField(value,placeholder) %}
    <p>
        <div class="input-group input-group-reg date allow-future-date">
            <input class="form-control form-control-modif not-mapped-simplefield" type="text" value="{{ value }}" placeholder="{{ placeholder }}">
            <span class="input-group-addon calendar-icon-button"><i class="glyphicon glyphicon-calendar"></i></span>
        </div>
    </p>
{% endmacro %}


{% macro complexPatient(ID,Active,lastName,firstName,MRN,InOut,HLAA,HLAB,RogosinDate,RogosinPRA,NYBCDate,ProductStatus,Expires) %}
    {% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}
    {% import "OlegCallLogBundle::Default/calllogmacros.html.twig" as calllogmacros %}

    <tr class="">
        <td> <a href="#">{{ ID }}</a> </td>
        <td>{{ Active }}</td>
        <td>{{ lastName }}</td>
        <td>{{ firstName }}</td>
        <td>{{ MRN }}</td>
        <td>{{ InOut }}</td>
        <td>{{ HLAA }}</td>
        <td>{{ HLAB }}</td>
        <td>{{ RogosinDate }}</td>
        <td>{{ RogosinPRA }}</td>
        <td>{{ NYBCDate }}</td>
        <td>{{ ProductStatus }}</td>
        <td>{{ Expires }}</td>

        <td class="rowlink-skip">

            <!-- Modal -->
            <div class="modal fade" id="edit_{{ ID }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close comment_modal_close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title text-center" id="myModalLabel">Edit Complex Patient ID {{ ID }}</h4>
                        </div>
                        <div class="modal-body">

                            <div id="modal_error_4" class="modal_error_div"></div>

                            <form id="addcomment_form">

                                {{ formmacros.simplefield('Active:',Active,'input') }}
                                {{ formmacros.simplefield('Last Name:',lastName,'input') }}
                                {{ formmacros.simplefield('First Name:',firstName,'input') }}
                                {{ formmacros.simplefield('In/Out:',InOut,'input') }}
                                {{ formmacros.simplefield('HLAA:',HLAA,'input') }}
                                {{ formmacros.simplefield('HLAB:',HLAB,'input') }}
                                {{ calllogmacros.simpleDateField('Rogosin Date:',RogosinDate,'Rogosin Date') }}
                                {{ formmacros.simplefield('RogosinPRA:',RogosinPRA,'input') }}
                                {{ calllogmacros.simpleDateField('NYBC Date:',NYBCDate,'NYBC Date') }}
                                {{ formmacros.simplefield('Product Status:',ProductStatus,'input') }}
                                {{ calllogmacros.simpleDateField('Expires:',Expires,'Expires') }}

                                <div class="center-block">
                                    <input id="edit_{{ ID }}" class="btn btn-primary center-block" type="button" value="Edit"/>
                                </div>

                            </form>

                        </div>
                    </div>
                </div>
            </div>


            <div class="btn-group">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                    Action <span class="caret"></span>
                </button>


                <ul class="dropdown-menu dropdown-menu-right">

                    <li>
                        <a href="#" data-toggle="modal" data-target="#edit_{{ ID }}">Edit</a>
                    </li>

                </ul>

            </div>


        </td>
    </tr>
{% endmacro %}


{% macro patientInfoSectionView(form,encounterPatientInfo,cycle,holderId,title,formtype) %}

    {% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}

    <div id="{{holderId}}" class="calllog-patient-holder">

        {#form.vars.value.id={{ form.vars.value.id }}#}
        <input type="hidden" id="calllog-patient-id-{{holderId}}" class="calllog-patient-id" value="{{ form.vars.value.id }}" />

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a class="calllog-patient-panel-title" data-toggle="collapse" href="#calllog-PatientInformation-{{holderId}}">
                        {{ title }}
                    </a>
                </h4>
            </div>
            <div id="calllog-PatientInformation-{{holderId}}" class="calllog-patient-information-panel panel-collapse collapse in">
                <div class="panel-body">

                    {#{{ form_errors(form) }}#}

                    {#{{ form_widget(form.id) }}#}
                    {#{{ form_row(form.id) }}#}

                    {{ form.vars.value.obtainPatientInfoSimple|raw }}

                    {#<div class="calllog-search-fields">#}

                        {#{% for mrn in form.mrn %}#}
                            {#{% if mrn.status == 'valid' or not mrn.vars.value.field %}#}
                            {#{{ formmacros.field(mrn.keytype) }}#}
                            {#{{ formmacros.field(mrn.field) }}#}
                            {#{% endif %}#}
                        {#{% endfor %}#}

                        {#{% for dob in form.dob %}#}
                            {#{{ formmacros.fieldDateLabel(dob.field,'regular-datepicker') }}#}
                        {#{% endfor %}#}

                        {#{% set status = 'Submitted' %}#}

                        {#{% set encounterPatientInfo = null %}#}
                        {#{% set encounterEncounterInfo = null %}#}
                        {#{% for encounter in form.encounter %}#}
                            {#encounter.vars.value.status={{ encounter.vars.value.status }}#}
                            {#message.vars.value.id={{ message.vars.value.id }}<br>#}
                            {#{% if encounter.vars.value.message %}#}
                                {#{% set encounterHasMessage = false %}#}
                                {#{% for encounterMessage in encounter.vars.value.message %}#}
                                    {#encounterMessage.id={{ encounterMessage.id }}<br>#}
                                    {#{% if encounterMessage.id == message.vars.value.id %}#}
                                        {#{% set encounterHasMessage = true %}#}
                                    {#{% endif %}#}
                                {#{% endfor %}#}
                                {#{% if encounter.vars.value.status == 'valid' and encounterHasMessage  %}#}
                                    {#{% set encounterPatientInfo = encounter %}#}
                                {#{% endif %}#}
                            {#{% endif %}#}
                        {#{% endfor %}#}

                        {#{% if encounterPatientInfo is defined and encounterPatientInfo %}#}
                            {#<div class="alias-group">#}
                                {#{{ formmacros.inputArrayField(encounterPatientInfo.patlastname,cycle,"encounterpatlastname","","","","",status) }}#}
                                {#{{ formmacros.inputArrayField(encounterPatientInfo.patfirstname,cycle,"encounterpatfirstname","","","","",status) }}#}
                                {#{{ formmacros.inputArrayField(encounterPatientInfo.patmiddlename,cycle,"encounterpatmiddlename","","","","",status) }}#}
                                {#{{ formmacros.inputArrayField(encounterPatientInfo.patsuffix,cycle,"encounterpatsuffix","","","","",status) }}#}
                                {#{{ formmacros.inputArrayField(encounterPatientInfo.patsex,cycle,"encounterpatsex","","","","",status) }}#}
                            {#</div>#}
                        {#{% endif %}#}

                    {#</div>#}

                    {#<a class="collapsed" role="button" data-toggle="collapse" href="#encounter-info">Encounter Info Test</a>#}
                    {#<div id="encounter-info" class="panel-collapse collapse">#}
                        {#{% if encounterPatientInfo is defined and encounterPatientInfo %}#}

                            {#{{ form_row(encounterPatientInfo.status) }}#}

                            {#<div class="alias-group">#}
                                {#{{ formmacros.inputArrayField(encounterPatientInfo.patmiddlename,cycle,"encounterpatmiddlename","","","","",status) }}#}
                                {#{{ formmacros.inputArrayField(encounterPatientInfo.patsuffix,cycle,"encounterpatsuffix","","","","",status) }}#}
                            {#</div>#}
                            {#{{ formmacros.inputArrayField(encounterPatientInfo.patsex,cycle,"encounterpatsex","","","","",status) }}#}

                        {#{% endif %}#}
                    {#</div>#}

                    <br>

                    <div id="calllog-danger-box" class="alert alert-danger" style="display: none; margin-top: 5px;"></div>

                    <div id="calllog-matching-patients" style="display: none; margin-top: 5px;"></div>

                </div> <!-- panel-body -->
            </div> <!-- panel-collapse -->
        </div> <!-- panel panel-info -->

    </div>

{% endmacro %}

{% macro patientInfoSection(form,cycle,holderId,title,formtype) %}

    {% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}

    <div id="{{holderId}}" class="calllog-patient-holder">

    {#form.vars.value.id={{ form.vars.value.id }}#}
    <input type="hidden" id="calllog-patient-id-{{holderId}}" class="calllog-patient-id" value="{{ form.vars.value.id }}" />

    <div class="panel panel-primary">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a class="calllog-patient-panel-title" data-toggle="collapse" href="#calllog-PatientInformation-{{holderId}}">
                    {{ title }}
                </a>
            </h4>
        </div>
        <div id="calllog-PatientInformation-{{holderId}}" class="calllog-patient-information-panel panel-collapse collapse in">
            <div class="panel-body">

                {{ form_errors(form) }}

                {#{{ form_widget(form.id) }}#}
                {{ form_row(form.id) }}

                {#Master radio#}
                {% if formtype == 'merge' %}
                    {#<input type="radio" name="gender" value="male"> Male<br>#}
                    <p>
                    <div class="row">
                        <div class="col-xs-6" align="right">
                            <label>Master Merge Record:</label>
                        </div>
                        <div class="col-xs-6" align="left">
                            <input type="radio" name="calllog-patient-master-record" value="{{ form.vars.value.id }}" class="calllog-patient-id-radio">
                        </div>
                    </div>
                    </p>
                {% endif %}

                <div class="calllog-search-fields">

                    {% for mrn in form.mrn %}
                        {#{% if mrn.status == 'valid' or not mrn.vars.value.field %}#}
                            {{ formmacros.field(mrn.keytype) }}
                            {{ formmacros.field(mrn.field) }}
                        {#{% endif %}#}
                    {% endfor %}

                    {% for dob in form.dob %}
                        {{ formmacros.fieldDateLabel(dob.field,'regular-datepicker') }}
                    {% endfor %}

                    {% set status = 'Submitted' %}

                    {% set encounterPatientInfo = null %}
                    {#{% set encounterEncounterInfo = null %}#}
                    {% for encounter in form.encounter %}
                        {% if encounter.vars.value.status == 'invalid'  %}
                            {% set encounterPatientInfo = encounter %}
                        {% else %}
                            {#{% set encounterEncounterInfo = encounter %}#}
                        {% endif %}
                    {% endfor %}

                    {% if encounterPatientInfo is defined and encounterPatientInfo %}
                        <div class="alias-group">
                            {{ formmacros.inputArrayField(encounterPatientInfo.patlastname,cycle,"encounterpatlastname","","","","",status) }}
                            {{ formmacros.inputArrayField(encounterPatientInfo.patfirstname,cycle,"encounterpatfirstname","","","","",status) }}
                        </div>
                    {% endif %}

                </div>

                {#<a class="collapsed" role="button" data-toggle="collapse" href="#encounter-info">Encounter Info Test</a>#}
                <div id="encounter-info" class="panel-collapse collapse">
                    {% if encounterPatientInfo is defined and encounterPatientInfo %}

                        {{ form_row(encounterPatientInfo.status) }}

                        <div class="alias-group">
                            {{ formmacros.inputArrayField(encounterPatientInfo.patmiddlename,cycle,"encounterpatmiddlename","","","","",status) }}
                            {{ formmacros.inputArrayField(encounterPatientInfo.patsuffix,cycle,"encounterpatsuffix","","","","",status) }}
                        </div>
                        {{ formmacros.inputArrayField(encounterPatientInfo.patsex,cycle,"encounterpatsex","","","","",status) }}

                    {% endif %}
                </div>


                <div class="row">
                    <div class="col-xs-5"></div>
                    <div class="col-xs-2">
                        <button id="search_patient_button" type="button"
                                class="btn btn-lg btn-success span4" align="center"
                                onclick="findCalllogPatient('{{ holderId }}','{{ formtype }}')" style="float:left; min-width:100%"
                        >Find Patient</button>
                        <button
                                id="reenter_patient_button" type="button"
                                class="btn btn-lg btn-success span4" align="center"
                                onclick="clearCalllogPatient('{{ holderId }}')" style="float:left; min-width:100%; display:none;"
                        >Re-enter Patient</button>
                    </div>
                    {% if formtype == 'call-entry' %}
                    <div class="col-xs-3">
                        <button
                                id="addnew_patient_button" type="button"
                                class="btn btn-lg btn-success span4" align="center"
                                onclick="addnewCalllogPatient('{{ holderId }}')" style="float:left; min-width:100%; display:none;"
                        >Add New Patient Registration</button>
                    </div>
                    <div class="col-xs-3">
                        <button
                                id="edit_patient_button" type="button"
                                class="btn btn-lg btn-success span4" align="center"
                                onclick="editPatientBtn('{{ holderId }}')" style="float:left; min-width:100%; display:none;"
                        >Edit Patient Info</button>
                    </div>
                    {% endif %}
                    <div class="col-xs-5"></div>
                </div>

                <br>

                <div id="calllog-danger-box" class="alert alert-danger" style="display: none; margin-top: 5px;"></div>

                <div id="calllog-matching-patients" style="display: none; margin-top: 5px;"></div>

            </div> <!-- panel-body -->
        </div> <!-- panel-collapse -->
    </div> <!-- panel panel-info -->

    </div>

{% endmacro %}


{#TODO: change "Location Name" to be a Select2 dropdown list of all locations filtered by Location type = "Encounter Location"#}
{#Selecting the Encounter Location from the dropdown should load all of its corresponding values into the other fields of this accordion (phone number, etc) via AJAX.#}
{% macro trackerContactinfoForm( entity, cycle, status ) %}
    {% if entity.tracker.spots is defined and entity.tracker.spots|length > 0 %}
        {% import "OlegUserdirectoryBundle::Default/usermacros.html.twig" as usermacros %}
        {% import "OlegCallLogBundle::Default/calllogmacros.html.twig" as calllogmacros %}

        {% set sitename = 'scan' %}
        {% set currentUser = app.security.getToken().getUser() %}
        {% set counter = 0 %}

        {% for spot in entity.tracker.spots %}
            <div class="panel panel-default">

                <div class="panel-heading">

                    {% if entity.vars.value.id %}
                        {% set orderUniqueId = entity.vars.value.id %}
                    {% else %}
                        {% set orderUniqueId = 0 %}
                    {% endif %}

                    {% set uniqueId = orderUniqueId~"_"~counter %}

                    {#<button#}
                            {#id="form_body_toggle_entitycontactinfo_{{ uniqueId }}" type="button"#}
                            {#class="btn btn-default btn-xs form_body_toggle_btn glyphicon glyphicon-folder-close pull-left"#}
                            {#onclick="calllogToggleSingleEncounterPanel(this,'#form_body_entitycontactinfo_{{ uniqueId }}');">#}
                    {#</button>#}

                    {% set panelTitle = spot.currentLocation.vars.value.name %}
                    {% if not panelTitle %}
                        {% set panelTitle = "Encounter's Location" %}
                    {% endif %}

                    <h4 class="panel-title">
                        {#{% if cycle != 'show' %}#}
                            {#<a#}
                                {#href="javascript:;"#}
                                {#onclick="calllogToggleSingleEncounterPanel(this,'#form_body_entitycontactinfo_{{ uniqueId }}');"#}
                            {#>#}
                                {#{{ panelTitle }}#}
                            {#</a>#}
                        {#{% else %}#}
                            <a class="calllog-patient-panel-title" data-toggle="collapse" href="#form_body_entitycontactinfo_{{uniqueId}}">
                                {{ panelTitle }}
                            </a>
                        {#{% endif %}#}
                    </h4>
                </div>

                <div id="form_body_entitycontactinfo_{{ uniqueId }}" class="panel-body collapse">
                    {#{{ usermacros.locationObject(spot.currentLocation,cycle,'user-locations','noprototype',sitename,currentUser,'editable') }}#}
                    {{ calllogmacros.locationSimpleObject(entity,spot.currentLocation,cycle,'user-locations','noprototype',sitename,currentUser,'editable') }}
                </div>
            </div>

            {% set counter = counter + 1 %}
        {% endfor %}
    {% endif %}
{% endmacro %}

{% macro locationSimpleObject( encounter, field, cycle, classname, prototype, sitename, entity, editable ) %}
    {% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}
    {% import "OlegUserdirectoryBundle::Default/usermacros.html.twig" as usermacros %}

    {% if prototype == "prototype" %}
        {% set formfield = field.vars.prototype %}
    {% else %}
        {% set formfield = field %}
    {% endif %}

    {{ formmacros.field(formfield.id) }}

    {% if encounter.locationName is defined %}
        {{ formmacros.field(encounter.locationName) }}
        <div style="display: none">
            {{ formmacros.field(formfield.name) }}
        </div>
    {% else %}
        {{ formmacros.field(formfield.name) }}
    {% endif %}

    {% if formfield.locationTypes is defined %}
        {{ formmacros.field(formfield.locationTypes) }}
    {% endif %}

    {{ usermacros.emailPhoneField(formfield.phone,cycle,'phone',"") }}

    {% if formfield.room is defined %}
        {{ formmacros.field_notempty(formfield.room,cycle) }}
    {% endif %}

    {% if formfield.suite is defined %}
        {{ formmacros.field_notempty(formfield.suite,cycle) }}
    {% endif %}

    {% if formfield.floor is defined %}
        {{ formmacros.field(formfield.floor) }}
    {% endif %}

    {% if formfield.floorSide is defined %}
        {{ formmacros.field(formfield.floorSide) }}
    {% endif %}

    {{ formmacros.field(formfield.building) }}

    {{ usermacros.geoLocation(formfield,cycle,prototype) }}

    {{ formmacros.field_notempty(formfield.comment,cycle) }}

{% endmacro %}
