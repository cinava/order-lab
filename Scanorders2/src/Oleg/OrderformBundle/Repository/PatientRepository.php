<?php

namespace Oleg\OrderformBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * PatientRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PatientRepository extends EntityRepository
{
    //make sure the uniqueness entity. Make new or return id of existing.
    public function processEntity( $in_entity ) { 
        
        //set up unknown patient
        if( $in_entity->getMrn() == "" || $in_entity->getMrn() == null ) {
            $in_entity->setMrn('000');
        }
        
        $entity = $this->findOneBy(array('mrn' => $in_entity->getMrn()));
        $em = $this->_em;
        
        if( null === $entity ) {        
            //create new                                                
            $em->persist($in_entity);                            
            return $in_entity;
        } 
              
        $em->persist($entity);

        return $entity;
    }
    
}
