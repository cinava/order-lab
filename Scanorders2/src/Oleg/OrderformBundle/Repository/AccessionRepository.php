<?php

namespace Oleg\OrderformBundle\Repository;
use Doctrine\ORM\EntityRepository;

use Oleg\OrderformBundle\Entity\Accession;

/**
 * AccessionRepository
 * This class was generated by the Doctrine ORM.
 * Add your own custom repository methods below.
 */
class AccessionRepository extends EntityRepository {
    
    //this function will add if accession doesn't exist or return id of existing accession
    //return accession object
    public function processAccession( $accession_number ) {     
        $entity = $this->findOneBy(array('accession' => $accession_number));
        if (!$entity) {        
            //create new accession
            $entity = new Accession();
            $entity->setAccession( $accession_number );         
            //$em = $this->getDoctrine()->getManager();  
            $em = $this->_em;
            $em->persist($entity);
            $em->flush();
        } 
        
        return $entity;
    }
    
}
?>
