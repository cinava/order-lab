<?php

namespace Oleg\OrderformBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * PartRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PartRepository extends EntityRepository
{
    
    //this function will create an entity if it doesn't exist or return the existing entity object
    public function processEntity( $part ) {  
        
        $entity = $this->findOneBy( array(
            'name' => $part->getName()
            //'accession' => $part->getAccession()
        ));
        
        //check if accession is the same or new
//        $accNum = $part->getAccession()->getAccession();
//        $accession = $em->getRepository('Accession')->findOneBy( array(          
//            'accession' => $accNum
//        ));
        
        
        
        //if( $accession->getPart()->getName() != $part->getName() ) { 
        if( !entity ) {
            //create new entity           
            $em = $this->_em;
            $em->persist($part);
            $em->flush();
            
            return $part;
        } 
        
        return $entity;
    }
    
}
