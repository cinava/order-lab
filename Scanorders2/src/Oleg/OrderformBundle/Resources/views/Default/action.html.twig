
{% block action %}


    {% include 'OlegOrderformBundle::History/add_comment.html.twig' with {'orderid': entity.oid,'comments': comments}  %}


    <div class="btn-group">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
          Action <span class="caret"></span>
        </button>

        {% set statusname = entity.status.name %}
        {% set Submitted = "Submitted" in statusname %}
        {% set Filled = "Filled" in statusname %}
        {% set Amended = "Amended" in statusname %}
        {% set Canceled = "Canceled" in statusname %}
        {% set OnHold = "On Hold" in statusname %}
        {% set Superseded = "Superseded" in statusname %}

        {#style="left: -230%;"#}
        <ul class="dropdown-menu dropdown-menu-right">
            
            <li><a href="{{ path('multy_show', { 'id': entity.oid }) }}">View Order Content</a></li>
            <li><a href="{{ path('history_orderinfo_show', { 'id': entity.oid }) }}">View Progress & Comments</a></li>

            {#<li><a href="{{ path('history_orderinfo_show', { 'id': entity.oid }) }}">Add Comment</a></li>#}
            <li>
                <a href="#" data-toggle="modal" data-target="#addComment_{{ entity.oid }}">Add Comment</a>
            </li>

            {% if not Superseded and not Filled and not Submitted and not Amended and not Filled and not OnHold %}
                <li class="divider"></li>
            {% endif %}

            {###############  USER ACTIONS #################}
            {% if not Canceled and not Superseded and not Filled %}
                <li><a data-confirm="Are you sure you want to change status to Cancel?"
                       class="action-cancel-status"
                       href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'cancel' }) }}">Cancel</a>
                </li>                  
            {% endif %}

            {#or is_granted('ROLE_ADMIN')#}
            {% if not Canceled and not Superseded and not Submitted and not Amended and not Filled and not OnHold %}
                <li><a data-confirm="Are you sure you want to change status to Submit?"
                       href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'submit' }) }}">Submit</a>
                </li>
            {% endif %}

            {% if Submitted and not Superseded and not Canceled and not Filled %}
                <li><a data-confirm="Are you sure you want to change status to Amend?"
                       class="action-amend-status"
                       href="{{ path('order_amend', { 'id': entity.oid }) }}">Amend</a>
                </li>
            {% endif %}


            {% if Canceled %}
                <li><a  data-confirm="Are you sure you want to change status to Un-Cancel?"
                        href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'Un-Cancel' }) }}">Un-Cancel</a>
                </li>
            {% endif %}

            {###############  ADMIN ACTIONS #################}
            {% if ( is_granted('ROLE_ADMIN') or is_granted('ROLE_PROCESSOR') ) and not Superseded and not Canceled %}

                <li class="divider"></li>
                
                {% if statusname != 'Filled: Scanned' %}
                    <li><a data-confirm="Are you sure you want to change status to Filled: Scanned?"
                           href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'Filled: Scanned' }) }}">Filled: Scanned</a>
                    </li>                  
                {% endif %}
                
                {% if statusname != 'Filled: Not Scanned' %}
                    <li><a data-confirm="Are you sure you want to change status to Filled: Not Scanned?"
                           href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'Filled: Not Scanned' }) }}">Filled: Not Scanned</a>
                    </li>                  
                {% endif %}
                
                {% if statusname != 'Filled: Some Scanned' %}
                    <li><a data-confirm="Are you sure you want to change status to Filled: Some Scanned?"
                           href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'Filled: Some Scanned' }) }}">Filled: Some Scanned</a>
                    </li>                  
                {% endif %}

                {% if statusname != 'Filled: Scanned & Returned' %}
                    <li><a data-confirm="Are you sure you want to change status to Filled: Scanned & Returned?"
                           href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'Filled: Scanned & Returned' }) }}">Filled: Scanned & Returned</a>
                    </li>
                {% endif %}

                {% if statusname != 'Filled: Not Scanned & Returned' %}
                    <li><a data-confirm="Are you sure you want to change status to Filled: Not Scanned & Returned?"
                           href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'Filled: Not Scanned & Returned' }) }}">Filled: Not Scanned & Returned</a>
                    </li>
                {% endif %}

                {% if statusname != 'Filled: Some Scanned & Returned' %}
                    <li><a data-confirm="Are you sure you want to change status to Filled: Some Scanned & Returned?"
                           href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'Filled: Some Scanned & Returned' }) }}">Filled: Some Scanned & Returned</a>
                    </li>
                {% endif %}

                <li class="divider"></li>

                {% if statusname != 'On Hold: Slides Received' %}
                    <li><a data-confirm="Are you sure you want to change status to On Hold: Slides Received?"
                           href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'On Hold: Slides Received' }) }}">On Hold: Slides Received</a>
                    </li>
                {% endif %}

                {% if statusname != 'On Hold: Awaiting Slides' %}
                    <li><a data-confirm="Are you sure you want to change status to On Hold: Awaiting Slides?"
                           href="{{ path('scanorder_status', { 'id': entity.oid, 'status': 'On Hold: Awaiting Slides' }) }}">On Hold: Awaiting Slides</a>
                    </li>
                {% endif %}

           {% endif %} {#admin#}

        </ul>

      </div>

{% endblock %}

