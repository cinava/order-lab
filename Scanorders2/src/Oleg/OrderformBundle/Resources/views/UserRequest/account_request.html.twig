<!DOCTYPE html>

<html>

<head>

    {% stylesheets
        'bundles/oleguserdirectory/bootstrap/css/*' filter='cssrewrite'
        'bundles/oleguserdirectory/select2/select2.css' filter='cssrewrite'
        'bundles/oleguserdirectory/form/css/form.css' filter='cssrewrite'
    %}
        <link rel="stylesheet" type="text/css" media="screen" href="{{ asset_url }}" />
    {% endstylesheets %}

    {% stylesheets
        'bundles/oleguserdirectory/datepicker/css/bootstrap-datepicker3.css' filter='cssrewrite'
    %}
        <link rel="stylesheet" type="text/css" media="screen" href="{{ asset_url }}" />
    {% endstylesheets %}



    {#http://www.telegraphicsinc.com/2013/10/using-bootstrap-3-with-internet-explorer-8-ie8/#}
    {% javascripts
    '@OlegUserdirectoryBundle/Resources/public/html5-bootstrap-fix/css3-mediaqueries.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    {% javascripts
    '@OlegUserdirectoryBundle/Resources/public/html5-bootstrap-fix/html5shiv.min.js'
    '@OlegUserdirectoryBundle/Resources/public/html5-bootstrap-fix/respond.min.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <![endif]-->




    <title>Account Request</title>

    {#<meta name="viewport" content="width=device-width, initial-scale=1.0">#}

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />

</head>

<body>


    {% import "OlegOrderformBundle::Default/formmacros.html.twig" as myform %}
    {% import "OlegUserdirectoryBundle::Tree/treemacros.html.twig" as treemacros %}

    <div class="container text-center">

        <input type="hidden" id="baseurl" value="{{app.request.host}}{{app.request.getBaseURL()}}" />
        <input type="hidden" id="formcycle" value="accountreq" />
        <input type="hidden" id="orderformtype" value="single" />

        <h2 class="alert alert-info well-lg safary-fix" align="center">Account Request</h2>

        <br>

        <form id="accountrequestform" action="{{ path('accountrequest_create') }}" method="post" {{ form_enctype(form) }}>

            {{ form_errors(form) }}

            {{ myform.field(form.systemAccountRequest) }}

            <p>
                <div class="row">
                    <div class="col-xs-6" align="right">
                        {#<b>Do you (the requester) have a <a href="javascript:;" onclick="window.open('http://weill.cornell.edu/its/identity-security/identity/cwid/');return false;">CWID</a> username?</b>#}
                        <b>Do you (the person for whom the account is being requested) have a <a href="http://weill.cornell.edu/its/identity-security/identity/cwid/">CWID</a> username?</b>
                    </div>
                    <div class="col-xs-6" align="left">
                        {{ form_widget(form.hascwid) }}
                    </div>
                </div>
            </p>

            {#usernametype#}
            <div id="usernametypeid_show_holder" class="collapse">
                <div class="well" align='center'>
                    <div class="row">
                        <div class="col-xs-6" align="right">
                            <label>Account Type:</label>
                        </div>
                        <div class="col-xs-6" align="left">
                            <select id="usernametypeid_show" class="combobox limit-font-size">
                                {% for  usernametype in usernametypes %}
                                    {% if user_type is defined and usernametype.name == user_type %}
                                        {% set selected = 'selected="selected"' %}
                                    {% else %}
                                        {% set selected = '' %}
                                    {% endif %}
                                    <option value="{{ usernametype.abbreviation }}" {{ selected }}>{{ usernametype.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            {{ myform.field(form.cwid) }}

            <div id="password_field" class="collapse">
                <div class="well" align='center'>
                    {{ myform.field(form.password) }}
                </div>
            </div>

            {{ myform.field(form.firstName) }}
            {{ myform.field(form.name) }}

            {{ myform.field(form.email) }}

            {{ myform.field(form.phone) }}
            {{ myform.field(form.job) }}

            {% if form.requestedInstitutionalPHIScope is defined %}
                {{ myform.field(form.requestedInstitutionalPHIScope) }}
            {% endif %}

            {% if form.requestedScanOrderInstitutionScope is defined %}
                {#{{ treemacros.compositeTreeNode(form.requestedScanOrderInstitutionScope,'','') }}#}
                {{ myform.field(form.requestedScanOrderInstitutionScope) }}
            {% endif %}

            {#{{ myform.field(form.institution) }}#}
            {#{{ myform.field(form.department) }}#}
            {#{{ myform.field(form.services) }}#}

            {{ myform.field(form.request) }}
            {{ myform.field(form.similaruser) }}

            <p style="padding-top:3px;">
            <div class="row">
                <div class="col-xs-6" align="right">
                    <label>
                        For reference, please provide the name and contact information of your supervisor or of the person who can confirm the validity of your request below.
                    </label>
                </div>
                <div class="col-xs-6" align="left">
                </div>
            </div>
            <div class="row">
                <div class="col-xs-6" align="right">
                    {{ form_label(form.referencename) }}
                </div>
                <div class="col-xs-6" align="left">
                    {{ form_widget(form.referencename) }}
                </div>
            </div>
            </p>
            {#{{ myform.field(form.referencename) }}#}

            {{ myform.field(form.referenceemail) }}
            {{ myform.field(form.referencephone) }}

            {% if form.creationdate is defined %}
                {% do form.creationdate.setRendered %}
            {% endif %}

            {#{{ form_rest(form) }}#}
            {{ form_widget(form._token) }}


            <br>
            <p>
                <button class="btn btn-info" type="button" onclick="submitRequestForm()">Submit</button>
            </p>

            <br>
            <p>
                <a href="{{ path(scan_sitename~'_login') }}">Return to Log In page</a>
            </p>

        </form>

        {#dummy login form with style="display:none"#}
        <form id="loginform" action="{{ path(scan_sitename~'_login_check') }}" method="post" style="display:none">
            <input type="hidden" name="display_height" id="display_height" value="" />
            <input type="hidden" name="display_width" id="display_width" value="" />

            <input type="text" id="username" name="_username" value="" class="form-control" placeholder="Username" autofocus>
            <input type="password" id="password" name="_password" class="form-control" placeholder="Password">
        </form>

        {% include 'OlegUserdirectoryBundle::Default/footer.html.twig' %}

    </div> <!-- /container -->

    <!-- send width and height info to the server -->
    {% javascripts
        '@OlegUserdirectoryBundle/Resources/public/form/js/errorwatch.js'
        '@OlegUserdirectoryBundle/Resources/public/jquery/jquery-1.11.0.min.js'
        '@OlegUserdirectoryBundle/Resources/public/bootstrap/js/*'
        '@OlegUserdirectoryBundle/Resources/public/select2/select2.js'
        '@OlegUserdirectoryBundle/Resources/public/inputmask/jquery.inputmask.bundle.js'
        '@OlegUserdirectoryBundle/Resources/public/q-1/q.js'
		
		'@OlegUserdirectoryBundle/Resources/public/form/js/user-common.js'

        '@OlegUserdirectoryBundle/Resources/public/form/js/user-selectAjax.js'
        '@OlegUserdirectoryBundle/Resources/public/form/js/user-treeSelectAjax.js'

        '@OlegOrderformBundle/Resources/public/form/js/masking.js'
        '@OlegOrderformBundle/Resources/public/form/js/selectAjax.js'
        '@OlegOrderformBundle/Resources/public/form/js/form.js'
        '@OlegOrderformBundle/Resources/public/form/js/commonCheckForm.js'	
		
    %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

    {#FOSJsRoutingBundle#}
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>


    <script language="Javascript">

        $(document).ready(function() {

            _ajaxTimeout = 60000;

            regularCombobox();
            customCombobox();			
            fieldInputMask();
            expandTextarea();
            initConvertEnterToTab();
           
			getComboboxCompositetree();

            $('.cwid').val('');

            $(".hascwid").find('input:radio').on('change', function(){
                var checkedValue = $(this).val();
                //console.log("checkedValue="+checkedValue);

                if( checkedValue == "Yes" ) {
                    $("#oleg_orderformbundle_userrequesttype_cwid").prop('disabled', false);
                    //disable all fields, except some
                    var allInputs = $(":input").not('.hascwid, .cwid-password, .cwid, :button, :radio, #username, #password, #usernametypeid_show');
                    allInputs.prop('disabled', true);
                    $('#password_field').show();
                    $('#usernametypeid_show_holder').show();
                } else {
                    $('.cwid').val('');
                    $(":input").prop('disabled', false);
                    $("#oleg_orderformbundle_userrequesttype_cwid").prop('disabled', true);
                    $('#password_field').hide();
                    $('#usernametypeid_show_holder').hide();
                }

            });

        });

        function submitRequestForm() {

            var checkedValue = $("#accountrequestform input[type='radio']:checked").val();

            if( checkedValue == "Yes" ) {

                //copy fields
                var cwid = $('.cwid').val();
                //add usertype
                var usertypeAbbreviation = $('#usernametypeid_show').select2('val');
                if( !usertypeAbbreviation || usertypeAbbreviation == "" || usertypeAbbreviation === null || typeof usertypeAbbreviation === 'object' ) {
                    usertypeAbbreviation = 'wcmc-cwid';
                }
                //console.log(usertypeAbbreviation);
                //alert(usertypeAbbreviation);
                var fullusername = cwid + "_@_" + usertypeAbbreviation;
                $('#username').val(fullusername);

                var pwd = $('.cwid-password').val();
                $('#password').val(pwd);

                $("#display_height").value = screen.height;
                $("#display_width").value = screen.width;

                $('#loginform').submit();

            } else {

                $('#accountrequestform').submit();

            }

        }

    </script>


</body>

</html>

