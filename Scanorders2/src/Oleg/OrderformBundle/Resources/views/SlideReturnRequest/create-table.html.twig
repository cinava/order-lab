{% extends "OlegOrderformBundle::Default/base.html.twig" %}

{% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}

{% block title %}
    Request Slide Return
{% endblock %}



{% block maincss %}

    {% stylesheets
    'bundles/olegorderform/handsontable/jquery.handsontable.full.css' filter='cssrewrite'
    'bundles/olegorderform/form/css/handsontable.css' filter='cssrewrite'

    'bundles/oleguserdirectory/select2/select2.css' filter='cssrewrite'
    'bundles/oleguserdirectory/ladda/ladda-themeless.css' filter='cssrewrite'

    'bundles/oleguserdirectory/form/css/action.css' filter='cssrewrite'
    'bundles/olegorderform/handsontable/lib/jquery-ui/css/ui-bootstrap/jquery-ui.custom.css' filter='cssrewrite'

    'bundles/oleguserdirectory/datepicker/css/datepicker3.css' filter='cssrewrite'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}

{% endblock %}


{% block mainjs %}

    {% javascripts
    '@OlegUserdirectoryBundle/Resources/public/jquery/jquery-1.11.0.min.js'

    '@OlegOrderformBundle/Resources/public/handsontable/lib/jquery-ui/js/jquery-ui.custom.min.js'
    '@OlegOrderformBundle/Resources/public/handsontable/jquery.handsontable.full.js'

    '@OlegUserdirectoryBundle/Resources/public/bootstrap/js/*'
    '@OlegUserdirectoryBundle/Resources/public/ladda/spin.min.js'
    '@OlegUserdirectoryBundle/Resources/public/ladda/ladda.min.js'
    '@OlegUserdirectoryBundle/Resources/public/datepicker/js/*'
    '@OlegUserdirectoryBundle/Resources/public/select2/select2.js'
    '@OlegUserdirectoryBundle/Resources/public/inputmask/jquery.inputmask.bundle.js'
	
	'@OlegUserdirectoryBundle/Resources/public/form/js/user-common.js'

    '@OlegOrderformBundle/Resources/public/form/js/checkSingleForm.js'
    '@OlegOrderformBundle/Resources/public/form/js/slideColl.js'
    '@OlegOrderformBundle/Resources/public/form/js/partRadios.js'
    '@OlegOrderformBundle/Resources/public/form/js/selectAjax.js'
    '@OlegOrderformBundle/Resources/public/form/js/commonCheckForm.js'
    '@OlegOrderformBundle/Resources/public/form/js/checkForm.js'
    '@OlegOrderformBundle/Resources/public/form/js/masking.js'
    '@OlegOrderformBundle/Resources/public/form/js/form.js'
    '@OlegOrderformBundle/Resources/public/form/js/modal.js'
    '@OlegOrderformBundle/Resources/public/form/js/tooltips.js'
	
	'@OlegUserdirectoryBundle/Resources/public/idletimeout/jquery.idletimeout.js'
    '@OlegUserdirectoryBundle/Resources/public/idletimeout/jquery.idletimer.js'
	'@OlegUserdirectoryBundle/Resources/public/form/js/user-idleTimeout.js'
    '@OlegOrderformBundle/Resources/public/form/js/idleTimeout.js'

    '@OlegUserdirectoryBundle/Resources/public/jasny/js/rowlink.js'
    '@OlegUserdirectoryBundle/Resources/public/q-1/q.js'

    '@OlegOrderformBundle/Resources/public/form/js/slide-return-request-table.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script language="Javascript">

        $(document).ready(function() {

            getComboboxReturnLocations();
            getUrgency();
            regularCombobox();
			setResearchEducational();
            windowCloseAlert();

        });

        function toggleSelectAllObjects(source) {
            $("[type=checkbox]").each(function() {
                $(this).prop('checked', source.checked);
            });
        }

        function toggleSelectAllCheckbox(source) {
            //console.log("source.checked="+source.checked);
            if( !source.checked ) {

                $('#selectUnselectAll').prop('checked', false);

            } else {

                //check if all checkboxes are checked => check selectUnselectAll
                var allchecked = true;

                $("[type=checkbox]").each(function() {
                    //console.log("check="+$(this).prop('checked')+", id="+$(this).attr("id"));
                    if( $(this).attr('id') != 'selectUnselectAll' && !$(this).prop('checked') ) {
                        allchecked = false;
                        return;
                    }
                });

                if( allchecked ) {
                    $('#selectUnselectAll').prop('checked', true);
                }

            } //else
        }

    </script>

{% endblock %}




{% block content %}

    <input type="hidden" id="formcycle" value="{{ cycle }}" />

    <input type="hidden" id="user_name" value="{{ form.vars.value.provider.getUserNameStr() }}" />
    <input type="hidden" id="user_id" value="{{ form.vars.value.provider.id }}" />
    <input type="hidden" id="proxyuser_name" value="{{ form.vars.value.proxyuser.getUserNameStr() }}" />
    <input type="hidden" id="proxyuser_id" value="{{ form.vars.value.proxyuser.id }}" />

    <h3 class="text-info">Please enter the information about the slides you would like to be returned</h3>

    <br>

    {############ START FORM ##############}
    <form id="table-slidereturnrequests" action="{{ path('slide-return-request-table-submit') }}" method="post" {{ form_enctype(form) }}>
    {#{{ form_start(form) }}#}

        <!-- handsontable -->
        <br>

        <p>
        <div id="multi-dataTable" class="text-center" align="middle" style="overflow: scroll"></div>
        </p>

        <br>

        <div id="validationerror" style="padding-top: 2%"></div>


            <div  class="panel panel-primary">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-12">
                            <h4 class="panel-title">Slide Return Request</h4>
                        </div>
                    </div>
                </div>
                <div class="panel-body collapse in">

                    {{ formmacros.field(form.slideReturnRequest.returnoption) }}
                    {#{{ formmacros.field(form.provider) }}#}
                    {{ formmacros.simplefield( "Submitter:", form.vars.value.provider.getUserNameStr(), "", "disabled" ) }}
                    {{ formmacros.field(form.proxyuser) }}
                    {{ formmacros.field(form.institution) }}

                    {% for destination in form.destinations %}
                        {{ formmacros.field(destination.location) }}
                    {% endfor %}

                    {{ formmacros.field(form.slideReturnRequest.urgency) }}

                    {#hidden, not mapped holder for table data#}
                    {{ formmacros.field(form.slideReturnRequest.datalocker) }}

                    {% do form.setRendered %}
                    {{ form_row(form._token) }}
                    {#{{ form_rest(form) }}#}
                </div>
            </div>

            <p>
                <button class="btn btn-success" type="submit">Submit</button>
            </p>

    </form>
    {#{{ form_end(form) }}#}
    {############ END FORM ##############}

{% endblock %}

