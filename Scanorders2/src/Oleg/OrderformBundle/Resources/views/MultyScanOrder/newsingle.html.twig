{% extends "OlegOrderformBundle::Default/base.html.twig" %}

{% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}

{% block title %}
    Scan Order
{% endblock %}

{#{% set cancheck = is_granted('ROLE_ALL_PATHOLOGY') %}#}
    
{% block content %}
    
    <h3 class="text-info">Scan Order</h3>

    {% if cycle != 'show' %}
        {% set mrnHtml = formmacros.inputField(form.patient.vars.prototype.mrn,cycle,"key","prototype") %}
        {% set nameHtml = formmacros.inputField(form.patient.vars.prototype.name,cycle,"","prototype") %}
        {% set sexHtml = formmacros.inputField(form.patient.vars.prototype.sex,cycle,"","prototype") %}
        {% set dobHtml = formmacros.inputField(form.patient.vars.prototype.dob,cycle,"","prototype") %}
        {% set ageHtml = formmacros.inputField(form.patient.vars.prototype.age,cycle,"","prototype") %}
        {% set clinicalhistoryHtml = formmacros.inputField(form.patient.vars.prototype.clinicalHistory,cycle,"","prototype") %}

        {% set accessionHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.accession,cycle,"key","prototype") %}
        {% set procedureHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.name,cycle,"","prototype") %}

        {% set partnameHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.partname,cycle,"key","prototype") %}
        {% set sourceorganHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.sourceOrgan,cycle,"","prototype") %}
        {% set paperHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.paper,cycle,"","prototype") %}
        {% set descriptionHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.description,cycle,"","prototype") %}
        {% set diagnosisHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.disident,cycle,"","prototype") %}

        {#{% set diffDiagnosesField = form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.diffDisident %}#}
        {#{% set diffDiagnosesWidget = formmacros.fieldWidget(diffDiagnosesField) %}#}
        {#{% set diffDiagnosesHtml = formmacros.inputField(diffDiagnosesField,cycle,"partdiffDisident","prototype",diffDiagnosesWidget,"") %}#}

        {% set diseaseTypeHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.diseaseType,cycle,"diseaseType","prototype") %}

        {% set blocknameHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.blockname,cycle,"key","prototype") %}
        {% set sectionsourceHtml = formmacros.inputField(form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.sectionsource,cycle,"","prototype") %}

        {% set relevantScansField = form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.relevantScans %}
        {% set relevantScansWidget = formmacros.fieldWidget(relevantScansField) %}
        {% set relevantScansHtml = formmacros.inputField(relevantScansField,cycle,"sliderelevantScans","prototype",relevantScansWidget,"") %}

        {% set specialStainsField = form.patient.vars.prototype.procedure.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.specialStains %}
        {% set specialStainsWidget = formmacros.fieldSpecialStainsWidget(specialStainsField) %}
        {% set specialStainsHtml = formmacros.inputField(specialStainsField,cycle,"slidespecialStains","prototype",specialStainsWidget,"buttonbottom","") %}

        {% set imgLoading = asset('bundles/olegorderform/form/img/select2-spinner.gif') %}
    {% endif %}


    {#{% set diffDiagnosesHtml = formmacros.inputField(diffDiagnosesField,'new',"partdiffDisident","prototype",diffDiagnosesWidget,"") %}#}

    {#<input type="hidden" id="formtype" value="single" />#}
    <input type="hidden" id="orderformtype" value="single" />
    {#<input type="hidden" id="formtype" value="multi" />#}
    <input type="hidden" id="formcicle" value="{{ cycle }}" />
    {#<input type="hidden" id="baseurl" value="{{app.request.host}}{{app.request.getBaseURL()}}" />#}
    
    <form id="scanorderform" action="{{ path('singleorder_create') }}" method="post" {{ form_enctype(form) }}>
    {#{{ form_start(form) }}#}

    {% for form_patient in form.patient %}
        {% for form_procedure in form_patient.procedure %}
            {% for form_accession in form_procedure.accession %}
                {% for form_part in form_accession.part %}
                    {% for form_block in form_part.block %}
                        {% for form_slide in form_block.slide %}

                            {% set diffDiagnosesField = form_part.diffDisident %}
                            {% set diffDiagnosesWidget = formmacros.fieldWidget(diffDiagnosesField) %}

                            {% set disidentField = form_part.disident %}
                            {% set disidentWidget = formmacros.fieldWidget(disidentField) %}

        {{ form_errors(form) }}
        {{ form_errors(form_patient) }}
        {{ form_errors(form_procedure) }}
        {{ form_errors(form_accession) }}
        {{ form_errors(form_part) }}
        {{ form_errors(form_block) }}
        {{ form_errors(form_slide) }}
        {#{{ form_errors(form_scan) }}#}
        {#{{ form_errors(form_stain) }}#}


        <div id="form-prototype-data"

             data-prototype-dataquality = "{{ formmacros.dataQualityWidget(form.dataquality.vars.prototype,cycle)|e }}"

             data-prototype-patientmrn=               "{{ mrnHtml|e }}"
             data-prototype-patientname=              "{{ nameHtml|e }}"
             data-prototype-patientsex=               "{{ sexHtml|e }}"
             data-prototype-patientdob=               "{{ dobHtml|e }}"
             data-prototype-patientage=               "{{ ageHtml|e }}"
             data-prototype-patientclinicalhistory=   "{{ clinicalhistoryHtml|e }}"

             {#data-prototype-addpartdisident="{{ formmacros.inputField(disidentField,'new',"partdisident","prototype",disidentWidget,"nobtn","")|e }}"#}
             data-prototype-partdisident="{{ formmacros.inputField(disidentField,'new',"partdisident","prototype",disidentWidget,"nobtn","")|e }}"

             data-prototype-addpartdiffDisident="{{ formmacros.inputField(diffDiagnosesField,'new',"partdiffDisident","prototype",diffDiagnosesWidget,"","")|e }}"
             data-prototype-partdiffDisident="{{ formmacros.inputField(diffDiagnosesField,'new',"partdiffDisident","prototype",diffDiagnosesWidget,"nobtn","")|e }}"

             {#data-prototype-relevantscans="{{ form_widget(form_slide.relevantScans.vars.prototype.field)|e }}"#}
             {#data-prototype-specialstains="{{ form_widget(form_slide.specialStains.vars.prototype.field)|e }}"#}
                {#requires for adding field by pressing +; to remove label replace the last "" by "nolabel"#}
             data-prototype-addsliderelevantScans="{{ formmacros.inputField(relevantScansField,cycle,"sliderelevantScans","prototype",relevantScansWidget,"","")|e }}"
                {#requires for check form to populate fields by AJAX (no '+' buttons)#}
             data-prototype-sliderelevantScans="{{ formmacros.inputField(relevantScansField,cycle,"sliderelevantScans","prototype",relevantScansWidget,"nobtn","")|e }}"

                {#requires for adding field by pressing +; to remove label replace the last "" by "nolabel"#}
             data-prototype-addslidespecialStains="{{ formmacros.inputField(specialStainsField,cycle,"slidespecialStains","prototype",specialStainsWidget,"nobtn","","","withspace")|e }}"
                {#requires for check form to populate fields by AJAX (no '+' buttons)#}
             data-prototype-slidespecialStains="{{ formmacros.inputField(specialStainsField,cycle,"slidespecialStains","prototype",specialStainsWidget,"nobtn","","","withspace")|e }}"

        >
        </div>

    <div class="singleorderinfo" id="singleorderinfo_0_0_0_0_0_0_0_0">

        <div class="panel panel-primary">

            <div class="panel-heading">
                {#<div class="row">#}
                    {#<div class="col-xs-12">#}
                        <h4 class="panel-title">Slide Info</h4>
                    {#</div>#}
                {#</div>#}
            </div>
            <div id="main" class="panel-body collapse in">

                {{ formmacros.field(form_accession.accession|first.keytype) }}

                <div class="row">
                    <div class="col-xs-6" align="right">
                        {{ form_label(form_accession.accession, "* Accession Number [or Label], Part, Block:") }}
                    </div>
                    <div class="col-xs-6" align="left">
                        <div style="float:left; width:100%">
                            <div style="float:left; width:50%" id="accession-single">
                                {{ form_widget(form_accession.accession|first.field) }}
                                <button style="display: none;" id="check_btn" class="btn btn-default accessionbtn" type="button" onclick="checkForm(this,true)" data-loading-text="<img src='{{ imgLoading }}' />"><i class="checkbtn glyphicon glyphicon-check"></i></button>
                            </div>
                            <div style="float:left; width:25%" id="part-single">
                                {{ form_widget(form_part.partname|first) }}
                                <button style="display: none;" id="check_btn" class="btn btn-default partbtn" type="button" onclick="checkForm(this,true)" data-loading-text="<img src='{{ imgLoading }}' />"><i class="checkbtn glyphicon glyphicon-check"></i></button>
                            </div>
                            <div style="float:left; width:25%" id="block-single">
                                {{ form_widget(form_block.blockname|first) }}
                                <button style="display: none;" id="check_btn" class="btn btn-default blockbtn" type="button" onclick="checkForm(this,true)" data-loading-text="<img src='{{ imgLoading }}' />"><i class="checkbtn glyphicon glyphicon-check"></i></button>
                            </div>
                            <div style="float:left; width:10%; display:none;" id="maincinglebtn">
                                <button id="remove_single_btn" class="btn btn-default maincinglebtn" type="button" onclick="removeFormSingle(this)" data-loading-text="<img src='{{ imgLoading }}' />"><i class="removebtn glyphicon glyphicon-remove"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

                {{ formmacros.field(form_slide.stain|first.field) }}
                {{ formmacros.field(form_slide.stain|first.stainothers) }}

                {{ formmacros.field(form_slide.scan|first.field) }}
                {{ formmacros.field(form_slide.scan|first.scanothers) }}

                {#{{ formmacros.field(form_part.disident) }}#}
                {{ formmacros.inputArrayField(form_part.disident,'new',"partdisident") }}

                {{ formmacros.field(form_slide.scan|first.note) }}

            </div>
        </div>

        <button id="next_button" type="button" class="btn btn-success" onclick="checkSingleFormOnNext(this)" data-toggle="collapse">Next</button>



        <div id="orderinfo_param" class="collapse">
            {{ formmacros.orderinfo_panel(form,"Order Info") }}

            <div class="row">
                <p>
                    <button class="btn btn-primary btn-success" name="btnSubmit" type="submit">Submit</button>
                </p>
                <p><button id="save_order_onidletimeout_btn" class="btn btn-default" name="btnSaveOnIdleTimeout" type="submit" style="display: none;">Save and Continue Later</button></p>
            </div>

            {#        The optional parameter    #}
            <div class="row">
                <p>
                    <button onclick="checkFormSingle(this)" id="optional_button" type="button" class="btn btn-default" data-toggle="collapse">
                        Add Optional Info
                    </button>
                </p>
            </div>


            <div id="optional_param" class="collapse">
                <div  class="panel panel-primary">

                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-12">
                                {#<h4>Optional Info</h4>#}
                                <h4 class="panel-title">Optional Info</h4>
                            </div>
                        </div>
                    </div>

                    <div id="optional_param_tab_body" class="panel-body collapse in">

                        <div class="row">

{% set viewoption = 'panels' %}
{#{% set viewoption = 'tabs' %}#}
{#{% set viewoption = 'verticaltabs' %}#}
{#{% set viewoption = 'accordion' %}#}

{% if viewoption == 'panels' %}

    <div class="tab-content option_info_panel">

        <div class="panel panel-info">
            <div class="panel-heading"><h4 class="panel-title">Patient</h4></div>
            <div class="panel-body">
                {{ formmacros.patientForm(form_patient,"check","0","new",form.vars.value.status) }}
            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading"><h4 class="panel-title">Procedure</h4></div>
            <div class="panel-body">
                {{ formmacros.inputArrayField(form_procedure.name,'new',"procedurename") }}
            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading"><h4 class="panel-title">Part</h4></div>
            <div class="panel-body">
                {{ formmacros.inputArrayField(form_part.sourceOrgan,'new',"partsourceorgan") }}

                {{ formmacros.inputArrayField(form_part.paper,'new',"partpaper","paper") }}

                {{ formmacros.inputArrayField(form_part.description,'new',"partdescription") }}

                <div id="partdisident_marker"></div>

                {{ formmacros.inputArrayField(form_part.diffDisident,'new',"partdiffdisident","partdiffDisident") }}

                {{ formmacros.inputArrayField(form_part.diseaseType,'new',"partdiseasetype","diseaseType") }}
            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading"><h4 class="panel-title">Block</h4></div>
            <div class="panel-body">
                {{ formmacros.inputArrayField(form_block.sectionsource,'new',"blocksectionsource","blocksectionsource") }}
            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading"><h4 class="panel-title">Slide</h4></div>
            <div class="panel-body">
                {{ formmacros.field(form_slide.title) }}
                {{ formmacros.field(form_slide.slidetype) }}
                {{ formmacros.field(form_slide.microscopicdescr) }}
                {{ formmacros.inputArrayField(form_slide.specialStains,'new',"slidespecialstains","slidespecialStains","buttonbottom","") }}
                {{ formmacros.inputArrayField(form_slide.relevantScans,'new',"sliderelevantscans","sliderelevantScans") }}
            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading"><h4 class="panel-title">Scan</h4></div>
            <div class="panel-body">
                {{ formmacros.field(form_slide.scan|first.scanregion) }}
            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading"><h4 class="panel-title">Education</h4></div>
            <div class="panel-body">
                {{ formmacros.field(form.educational.goal) }}
                {{ formmacros.field(form.educational.course) }}
                {{ formmacros.field(form.educational.lesson) }}
            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading"><h4 class="panel-title">Research</h4></div>
            <div class="panel-body">
                {{ formmacros.field(form.research.project) }}
                {{ formmacros.field(form.research.principal) }}
            </div>
        </div>

{% endif %}

{% if viewoption == 'tabs' %}

                                <ul class="nav nav-tabs" id="optional_param_tab">
                                    <li class="active"><a href="#patient" data-toggle="tab">Patient</a></li>
                                    <li><a href="#procedure" data-toggle="tab">Procedure</a></li>
                                    {#<li><a href="#accession">Accession</a></li>#}
                                    <li><a href="#part" data-toggle="tab">Part</a></li>
                                    <li><a href="#block" data-toggle="tab">Block</a></li>
                                    <li><a href="#slide" data-toggle="tab">Slide</a></li>
                                    <li><a href="#scan" data-toggle="tab">Scan</a></li>

                                </ul>

                                <div class="tab-content option_info_panel">
                                    <div class="tab-pane fade in active" id="patient">
                                        {{ formmacros.patientForm(form_patient,"check","0","new",form.vars.value.status) }}
                                    </div>

                                    <div class="tab-pane fade" id="procedure">
                                      {{ formmacros.inputArrayField(form_procedure.name,'new',"procedurename") }}
                                    </div>

                                    <div class="tab-pane fade" id="part">
                                          {{ formmacros.inputArrayField(form_part.sourceOrgan,'new',"partsourceorgan") }}

                                          {{ formmacros.inputArrayField(form_part.paper,'new',"partpaper","paper") }}

                                          {{ formmacros.inputArrayField(form_part.description,'new',"partdescription") }}

                                          <div id="partdisident_marker"></div>
                                          {#{{ formmacros.inputArrayField(form_part.disident,'new',"partdisident") }}#}

                                          {{ formmacros.inputArrayField(form_part.diffDisident,'new',"partdiffdisident","partdiffDisident") }}

                                          {{ formmacros.inputArrayField(form_part.diseaseType,'new',"partdiseasetype","diseaseType") }}
                                    </div>

                                    <div class="tab-pane fade" id="block">
                                      {{ formmacros.inputArrayField(form_block.sectionsource,'new',"blocksectionsource","blocksectionsource") }}
                                    </div>

                                    <div class="tab-pane fade" id="slide">

                                      {{ formmacros.field(form_slide.title) }}

                                      {{ formmacros.field(form_slide.slidetype) }}

                                      {#{{ formmacros.field(form_slide.diagnosis) }}#}
                                      {{ formmacros.field(form_slide.microscopicdescr) }}
                                      {#{{ formmacros.field(form_slide.specialStains) }}#}
                                      {#{% if form_slide.specialStains|length > 0 %}#}
                                          {#{{ formmacros.collInput(form_slide.specialStains, 'new', 'single', 'specialStains', 0, 0, 0, 0, 0, 0) }}#}
                                      {#{% endif %}#}
                                      {{ formmacros.inputArrayField(form_slide.specialStains,'new',"slidespecialstains","slidespecialStains","buttonbottom","") }}

                                      {#{{ formmacros.field(form_slide.relevantScans) }}#}
                                      {#{% if form_slide.relevantScans|length > 0 %}#}
                                          {#&#123;&#35;{{ formmacros.collInput(form_slide.relevantScans, 'new', 'single', 'relevantScans', 0, 0, 0, 0, 0, 0) }}&#35;&#125;#}
                                          {#{{ formmacros.collectionInput(form_slide.relevantScans, 'relevantScans', 'new', 'single', 0, 0, 0, 0, 0, 0) }}#}
                                      {#{% endif %}#}
                                      {{ formmacros.inputArrayField(form_slide.relevantScans,'new',"sliderelevantscans","sliderelevantScans") }}

                                      {#{{ formmacros.slideForm(form_slide, "check", "0_0_0_0_0_0_0_0", 'new') }}#}

                                    </div>

                                    <div class="tab-pane fade" id="scan">
                                        {{ formmacros.field(form_slide.scan|first.scanregion) }}
                                    </div>

{% endif %}


{% if viewoption == 'verticaltabs' %}
    <!-- tabs left -->
    <div class="tabbable tabs-left">
        <ul class="nav nav-tabs">
            <li><a href="#a" data-toggle="tab">One</a></li>
            <li><a href="#b" data-toggle="tab">Two</a></li>
            <li><a href="#c" data-toggle="tab">Twee</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="a">Lorem ipsum dolor sit amet, charetra varius quam sit amet vulputate.
                Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero.</div>
            <div class="tab-pane" id="b">Secondo sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.
                Aliquam in felis sit amet augue.</div>
            <div class="tab-pane" id="c">Thirdamuno, ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.
                Quisque mauris augue, molestie tincidunt condimentum vitae. </div>
        </div>
    </div>
    <!-- /tabs -->

                                <div class="tabbable tabs-left">
                                    <ul class="nav nav-tabs " data-tabs="tabs">
                                        <li class="active"><a href="#patient" data-toggle="tab">Patient</a></li>
                                        <li><a href="#part" data-toggle="tab">Part</a></li>
                                        <li><a href="#clothesTab" data-toggle="tab">Clothes</a></li>
                                        <li><a href="#booksTab" data-toggle="tab">Book</a></li>
                                    </ul>

                                    <div class="tab-content">
                                        <div class="tab-pane fade in active" id="patient">
                                            {{ formmacros.patientForm(form_patient,"check","0","new",form.vars.value.status) }}
                                        </div>
                                        <div class="tab-pane fade" id="part">
                                            {{ formmacros.inputArrayField(form_part.sourceOrgan,'new',"partsourceorgan") }}

                                            {{ formmacros.inputArrayField(form_part.paper,'new',"partpaper","paper") }}

                                            {{ formmacros.inputArrayField(form_part.description,'new',"partdescription") }}

                                            <div id="partdisident_marker"></div>
                                            {#{{ formmacros.inputArrayField(form_part.disident,'new',"partdisident") }}#}

                                            {{ formmacros.inputArrayField(form_part.diffDisident,'new',"partdiffdisident","partdiffDisident") }}

                                            {{ formmacros.inputArrayField(form_part.diseaseType,'new',"partdiseasetype","diseaseType") }}
                                        </div>
                                        <div class="tab-pane fade" id="clothesTab">
                                            clothing tab
                                        </div>
                                        <div class="tab-pane fade" id="booksTab">
                                            books books books
                                        </div>
                                    </div>
                                </div>

{% endif %}

{% if viewoption == 'accordion' %}

                                <div class="panel-group" id="accordion">
                                    <div class="panel panel-info">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#patient">
                                                    Patient
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="patient" class="panel-collapse collapse in">
                                            {#<div class="panel-body" id="patient">#}
                                                {{ formmacros.patientForm(form_patient,"check","0","new",form.vars.value.status) }}
                                            {#</div>#}
                                        </div>
                                    </div>
                                    <div class="panel panel-info">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#procedure">
                                                    Procedure
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="procedure" class="panel-collapse collapse">
                                            {#<div class="panel-body" id="procedure">#}
                                                {{ formmacros.inputArrayField(form_procedure.name,'new',"procedurename") }}
                                            {#</div>#}
                                        </div>
                                    </div>
                                    <div class="panel panel-info">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#part">
                                                    Part
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="part" class="panel-collapse collapse">
                                            {#<div class="panel-body" id="part">#}

                                                {{ formmacros.inputArrayField(form_part.sourceOrgan,'new',"partsourceorgan") }}

                                                {{ formmacros.inputArrayField(form_part.paper,'new',"partpaper","paper") }}

                                                {{ formmacros.inputArrayField(form_part.description,'new',"partdescription") }}

                                                <div id="partdisident_marker"></div>

                                                {{ formmacros.inputArrayField(form_part.diffDisident,'new',"partdiffdisident","partdiffDisident") }}

                                                {{ formmacros.inputArrayField(form_part.diseaseType,'new',"partdiseasetype","diseaseType") }}
                                            {#</div>#}
                                        </div>
                                    </div>

                                    <div class="panel panel-info">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#block">
                                                    Block
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="block" class="panel-collapse collapse">
                                            {#<div class="panel-body" id="part">#}
                                                {#<div class="tab-pane fade" id="block">#}
                                                {{ formmacros.inputArrayField(form_block.sectionsource,'new',"blocksectionsource","blocksectionsource") }}
                                                {#</div>#}
                                            {#</div>#}
                                        </div>
                                    </div>

                                    <div class="panel panel-info">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#slide">
                                                    Slide
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="slide" class="panel-collapse collapse">
                                            {#<div class="tab-pane fade" id="slide">#}

                                            {{ formmacros.field(form_slide.title) }}
                                            {{ formmacros.field(form_slide.slidetype) }}
                                            {{ formmacros.field(form_slide.microscopicdescr) }}
                                            {{ formmacros.inputArrayField(form_slide.specialStains,'new',"slidespecialstains","slidespecialStains","buttonbottom","") }}
                                            {{ formmacros.inputArrayField(form_slide.relevantScans,'new',"sliderelevantscans","sliderelevantScans") }}

                                            {#</div>#}
                                        </div>
                                    </div>


                                    <div class="panel panel-info">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#scan">
                                                    Scan
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="scan" class="panel-collapse collapse">
                                            {{ formmacros.field(form_slide.scan|first.scanregion) }}
                                        </div>
                                    </div>


                                </div>

{% endif %}




                            </div> <!-- row -->

                        </div>

                </div> <!-- class="panel panel-primary" -->
            </div> <!-- optional_param -->
                 
            {# Just in case display rest of the form to prevent CRF error #}
            {#{{ form_rest(form) }}#}
            {#{{ form_rest(form_patient) }}#}
            {#{{ form_rest(form_procedure) }}#}
            {#{{ form_rest(form_accession) }}#}
            {#{{ form_rest(form_part) }}#}
            {#{{ form_rest(form_block) }}#}
            {#{{ form_rest(form_slide) }}#}
            {#{{ form_rest(form_scan) }}#}
            {#{{ form_rest(form_stain) }}#}
            
        </div>  <!-- class="panel panel-primary" -->





        </div> <!-- singleorderinfo -->

    </div>
{#        <a class='btn_margin_top btn btn-primary' href="{{ path('orderinfo') }}">Back to the list</a>#}

                        {% endfor %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        {% endfor %}
    {% endfor %}


    <div id="validationerror" style="padding-top: 2%"></div>

    {#{{ form_end(form) }}#}
    </form>

    {#<div style="height: 200px;">&nbsp;</div>#}

{% endblock %}
