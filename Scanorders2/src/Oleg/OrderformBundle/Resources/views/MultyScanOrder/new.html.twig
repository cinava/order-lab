
{% extends "OlegOrderformBundle::Default/base.html.twig" %}



{% block content %}  
    
<h3 class="text-info">Clinical Multy Slide Scan Order </h3>

{#macro#}
{% macro field( field ) %}
    <div class="row-fluid">
        <div class="span6" align="right">
            {{ form_label(field) }}
        </div>
        <div class="span6" align="left">
            {{ form_widget(field) }}
        </div>
    </div>
{% endmacro %}

{% import _self as myform %}


<div id="patient-data"
       data-prototype="
            {{ myform.field(form.patient.vars.prototype.mrn)|e }}
            {{ myform.field(form.patient.vars.prototype.name)|e }}
            {{ myform.field(form.patient.vars.prototype.age)|e }}
            {{ myform.field(form.patient.vars.prototype.sex)|e }}
            {{ myform.field(form.patient.vars.prototype.dob)|e }}
            {{ myform.field(form.patient.vars.prototype.clinicalHistory)|e }}
       "
>
</div>

<div id="procedure-data"
       data-prototype="
            {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.proceduretype)|e }}
            {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.paper)|e }}
         "
>
</div>

<div id="accession-data"
         data-prototype="
            {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.accession)|e }}
            {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.date)|e }}
         "
>
</div>

<div id="part-data"
     data-prototype="
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.name)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.sourceOrgan)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.description)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.diagnosis)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.diffDiagnosis)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.diseaseType)|e }}
     "
>
</div>

<div id="block-data"
     data-prototype="
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.name)|e }}
     "
>
</div>

<div id="slide-data"
     data-prototype="
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.diagnosis)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.microscopicdescr)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.specialstain)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.relevantscan)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.stain.name)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.scan.mag)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.scan.scanregion)|e }}
        {{ myform.field(form.patient.vars.prototype.specimen.vars.prototype.accession.vars.prototype.part.vars.prototype.block.vars.prototype.slide.vars.prototype.scan.note)|e }}
     "
>
</div>

    {#<form action="{{ path('multy_create') }}" method="post">#}
{{ form_start(form) }}

    {#{{ form_errors(form) }}#}
    {#{{form_widget(form.patient.vars.prototype)|e}}#}
    {#data-prototype-specimen="{{ form_widget(form.patient.vars.prototype.children['specimen'].vars.prototype)|e }}"#}

{#<div id="formpanel" class="panel">#}

    {#<div>#}

    {#Note: addSameForm button pass variables - object name and 6 counts for: 1-patient, 2-proceudre, 3-accession, 4-part, 5-block, 6-slide#}

    {#patient#}
    {% set patientCount = 0 %}
    {% for patient in form.patient %}
        {% set uid = patientCount~'_'~0~'_'~0~'_'~0~'_'~0~'_'~0 %}
        {#{% set patientCountNext = patientCount + 1 %}#}
        <div id="formpanel_patient_{{ uid }}" class="panel panel-patient">
            <div class="panel-heading" align="left">
                <button type="button" class="btn btn-mini btn_margin btn-mini" data-toggle="collapse" data-target="#form_body_patient_{{ uid }}">
                    +/-
                </button>
                Patient {{ patientCount }}
                {% if form.patient|length ==  (patientCount + 1) %}
                <button id="form_add_btn_patient_{{ uid }}" type="button" class="btn btn-mini btn_margin" onclick="addSameForm('patient', {{ patientCount }}, 0, 0, 0, 0, 0)">Add Patient</button>
                {% endif %}
            </div>
            <div id="form_body_patient_{{ uid }}" class="panel-body collapse in">
                {{ myform.field(patient.mrn) }}
                {{ myform.field(patient.name) }}
                {{ myform.field(patient.age) }}
                {{ myform.field(patient.sex) }}
                {{ myform.field(patient.dob) }}
                {{ myform.field(patient.clinicalHistory) }}

                {#specimen/procedure#}
                {% set procedureCount = 0 %}
                {% for specimen in patient.specimen %}
                    {% set uid = patientCount~'_'~procedureCount~'_'~0~'_'~0~'_'~0~'_'~0 %}
                    <div id="formpanel_procedure_{{ uid }}" class="panel panel-procedure">
                        <div class="panel-heading" align="left">
                            <button id="form_body_btn_procedure_{{ procedureCount }}" type="button" class="btn btn_margin btn-mini" data-toggle="collapse" data-target="#form_body_procedure_{{ uid }}">
                                +/-
                            </button>
                            Procedure {{ procedureCount }}
                            {% if patient.specimen|length ==  (procedureCount + 1) %}
                            <button id="form_add_btn_specimen_{{ uid }}" type="button" class="btn btn-mini btn_margin" onclick="addSameForm('procedure', {{ patientCount }}, {{ procedureCount }}, 0, 0, 0, 0)">Add Procedure</button>
                            {% endif %}
                            <button onclick="return confirm('Are you sure?');" id="form_body_btn_procedure_{{ procedureCount }}" type="button" class="btn btn-danger btn_margin btn-mini" data-toggle="collapse" data-target="#form_body_procedure_{{ procedureCount }}">
                                Delete This Procedure
                            </button>
                        </div>
                        <div id="form_body_procedure_{{ uid }}" class="panel-body collapse in">
                            {#{{ form_row(specimen) }}#}
                            {{ myform.field(specimen.proceduretype) }}
                            {{ myform.field(specimen.paper) }}

                            {#accession#}
                            {% set accessionCount = 0 %}
                            {% for accession in specimen.accession %}
                                {% set uid = patientCount~'_'~procedureCount~'_'~accessionCount~'_'~0~'_'~0~'_'~0 %}
                                <div id="formpanel_accession_{{ uid }}" class="panel panel-accession">
                                    <div class="panel-heading" align="left">
                                        <a style="background-color:white;" data-toggle="collapse" href="#form_body_accession_{{ uid }}">+/-</a>
                                        Accession {{ accessionCount }}
                                        {% if specimen.accession|length ==  (accessionCount + 1) %}
                                        <button id="form_add_btn_accession_{{ uid }}" type="button" class="btn btn-mini btn_margin" onclick="addSameForm('accession', {{ patientCount }}, {{ procedureCount }}, {{ accessionCount }}, 0, 0, 0)">Add Accession</button>
                                        {% endif %}
                                    </div>
                                    <div id="form_body_accession_{{ uid }}" class="panel-body collapse in">
                                            {{ myform.field(accession.accession) }}
                                            {{ myform.field(accession.date) }}

                                        {#part#}
                                        {% set partCount = 0 %}
                                        {% for part in accession.part %}
                                            {% set uid = patientCount~'_'~procedureCount~'_'~accessionCount~'_'~partCount~'_'~0~'_'~0 %}
                                            <div id="formpanel_part_{{ uid }}" class="panel panel-part">
                                                <div class="panel-heading" align="left">
                                                    <button id="form_body_btn_part_{{ partCount }}" type="button" class="btn btn_margin btn-mini" data-toggle="collapse" data-target="#form_body_part_{{ uid }}">
                                                        +/-
                                                    </button>
                                                    Part {{ partCount }}
                                                    {% if accession.part|length ==  (partCount + 1) %}
                                                    <button id="form_add_btn_part_{{ uid }}" type="button" class="btn btn-mini btn_margin" onclick="addSameForm('part', {{ patientCount }}, {{ procedureCount }}, {{ accessionCount }}, {{ partCount }}, 0, 0)">Add Part</button>
                                                    {% endif %}
                                                </div>
                                                <div id="form_body_part_{{ uid }}" class="panel-body collapse in">
                                                    {{ myform.field(part.name) }}
                                                    {{ myform.field(part.sourceOrgan) }}
                                                    {{ myform.field(part.description) }}
                                                    {{ myform.field(part.diagnosis) }}
                                                    {{ myform.field(part.diffDiagnosis) }}
                                                    {{ myform.field(part.diseaseType) }}

                                                    {#block#}
                                                    {% set blockCount = 0 %}
                                                    {% for block in part.block %}
                                                        {% set uid = patientCount~'_'~procedureCount~'_'~accessionCount~'_'~partCount~'_'~blockCount~'_'~0 %}
                                                        <div id="formpanel_block_{{ uid }}" class="panel panel-block">
                                                                <div class="panel-heading" align="left">
                                                                    <button id="form_body_btn_block_{{ uid }}" type="button" class="btn btn_margin btn-mini" data-toggle="collapse" data-target="#form_body_block_{{ uid }}">
                                                                        +/-
                                                                    </button>
                                                                    Block {{ blockCount }}
                                                                    {% if part.block|length ==  (blockCount + 1) %}
                                                                    <button id="form_add_btn_block_{{ uid }}" type="button" class="btn btn-mini btn_margin" onclick="addSameForm('block', {{ patientCount }}, {{ procedureCount }}, {{ accessionCount }}, {{ partCount }}, {{ blockCount }}, 0)">Add Block</button>
                                                                    {% endif %}
                                                                </div>
                                                                <div id="form_body_block_{{ uid }}" class="panel-body collapse in">
                                                                    {{ myform.field(block.name) }}


                                                                    {#slide#}
                                                                    {% set slideCount = 0 %}
                                                                    {% for slide in block.slide %}
                                                                        {% set uid = patientCount~'_'~procedureCount~'_'~accessionCount~'_'~partCount~'_'~blockCount~'_'~slideCount %}
                                                                        <div id="formpanel_slide_{{ uid }}" class="panel panel-slide">
                                                                            <div class="panel-heading" align="left">
                                                                                <button id="form_body_btn_slide_{{ slideCount }}" type="button" class="btn btn_margin btn-mini" data-toggle="collapse" data-target="#form_body_slide_{{ uid }}">
                                                                                    +/-
                                                                                </button>
                                                                                Slide {{ slideCount }}
                                                                                {% if block.slide|length ==  (slideCount + 1) %}
                                                                                <button id="form_add_btn_slide_{{ uid }}" type="button" class="btn btn-mini btn_margin" onclick="addSameForm('slide', {{ patientCount }}, {{ procedureCount }}, {{ accessionCount }}, {{ partCount }}, {{ blockCount }}, {{ slideCount }})">Add Slide</button>
                                                                                {% endif %}
                                                                            </div>
                                                                            <div id="form_body_slide_{{ uid }}" class="panel-body collapse in">
                                                                                {{ myform.field(slide.diagnosis) }}
                                                                                {{ myform.field(slide.microscopicdescr) }}
                                                                                {{ myform.field(slide.specialstain) }}
                                                                                {{ myform.field(slide.relevantscan) }}
                                                                                {#stain and scan#}
                                                                                {{ myform.field(slide.stain.name) }}
                                                                                {{ myform.field(slide.scan.mag) }}
                                                                                {{ myform.field(slide.scan.scanregion) }}
                                                                                {{ myform.field(slide.scan.note) }}
                                                                            </div>
                                                                    </div> {#end of slide#}
                                                                    {% set slideCount = slideCount + 1 %}
                                                                {% endfor %}


                                                            </div>
                                                            {% set blockCount = blockCount + 1 %}
                                                        </div> {#end of block#}
                                                    {% endfor %}



                                                </div>
                                            </div> {#end of part#}
                                            {% set partCount = partCount + 1 %}
                                        {% endfor %}


                                    </div>
                                </div> {#end of accession#}
                                {% set accessionCount = accessionCount + 1 %}
                            {% endfor %}


                        </div>
                    </div>{#end of specimen #}
                    {% set procedureCount = procedureCount + 1 %}
                {% endfor %} {# specimen loop #}


            </div>{# end of form_body_patient_ #}
        </div> {#end of patient #}
        {% set patientCount = patientCount + 1 %}
    {% endfor %} {# patient loop #}


    {#</div>&#123;&#35; end of orderinfo-data&#35;&#125;#}


    {#{{ include(#}
        {#'OlegOrderformBundle::MultyScanOrder/panel.html.twig', {'name':'Patient','id':1, 'pid':1}#}
    {#) }}#}

{#    Test cal controller: it works!#}
{#    {% render url('part_new') %}#}

    <button id="next_button" type="button" class="btn" 
            data-toggle="collapse" data-target="#orderinfo_param">Next
    </button>


    <div id="orderinfo_param" class="collapse">
        <div class="row-fluid">
        <div class="span12">
        <h4>Scan Order Info</h4>   
        </div>
        </div>
        <div class="row-fluid">
        <div class="span6" align="right">
        {{ form_label(form.provider) }}
        </div>
        <div class="span6" align="left">
        {{ form_widget(form.provider) }} 
        </div>
        </div>
        <div class="row-fluid">
        <div class="span6" align="right">
        {{ form_label(form.pathologyService) }}
        </div>
        <div class="span6" align="left">
        {{ form_widget(form.pathologyService) }}
        </div>
        </div>

        <div class="row-fluid">
        <div class="span6" align="right">
        {{ form_label(form.priority) }}
        </div>
        <div class="span6" align="left">
        {{ form_widget(form.priority) }}
        </div>
        </div>
{#            optional for priority#}
        <div id="priority_option" class="collapse"> 
{#            <div class="oleg_padding_top_bottom text-info">#}
        <div class="well">

            <div class="row-fluid">              
            <div class="span6" align="right">              
            {{ form_label(form.scandeadline) }}
            </div>            
            <div class="span6" align="left">
            {{ form_widget(form.scandeadline) }} 
            </div>   
            </div>    

            <div class="row-fluid">              
            <div class="span6" align="right">
            {{ form_label(form.returnoption) }}
            </div>            
            <div class="span6" align="left">
            {{ form_widget(form.returnoption) }} 
            </div>   
            </div>    
        </div>    
        </div>  

        <div class="row-fluid">
        <div class="span6" align="right">
        {{ form_label(form.slideDelivery) }}
        </div>
        <div class="span6" align="left">
        {{ form_widget(form.slideDelivery) }}
        </div>
        </div>
        <div class="row-fluid">
        <div class="span6" align="right">
        {{ form_label(form.returnSlide) }}
        </div>
        <div class="span6" align="left">
        {{ form_widget(form.returnSlide) }}
        </div>
        </div>
        <div class="row-fluid">
        <div class="span12">
            <button class="btn_margin_top btn btn-primary btn-success" type="submit">Submit</button>        
        </div>
        </div> 
    </div>
   
     {#{{ form_rest(form) }}#}

{#</div>#}
    
{{ form_end(form) }}
{#</form>#}
    
{% endblock %}
  