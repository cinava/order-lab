{#
    Copyright 2017 Cornell University

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
#}

{#   navigation menu   #}

{% macro listUsers( pathlink, pathlink_loc, hasRoleSimpleView ) %}
    <ul class="dropdown-menu">

        <li><a href="{{ path(pathlink) }}">Employees</a></li>
        <li><a href="{{ path(pathlink,{'filter': 'WCM Pathology Employees'}) }}">WCM Pathology Employees</a></li>
        <li><a href="{{ path(pathlink,{'filter': 'WCM Pathology Faculty'}) }}">WCM Pathology Faculty</a></li>
        <li><a href="{{ path(pathlink,{'filter': 'WCM Pathology Clinical Faculty'}) }}">WCM Pathology Clinical Faculty</a></li>

        {% if not hasRoleSimpleView %}
            <li><a href="{{ path(pathlink,{'filter': 'WCM Pathology Physicians'}) }}">WCM Pathology Physicians</a></li>
        {% endif %}

        <hr style="margin-bottom:0; margin-top:0;">

        <li><a href="{{ path(pathlink,{'filter': 'WCM Pathology Research Faculty'}) }}">WCM Pathology Research Faculty</a></li>

        {% if not hasRoleSimpleView %}
            <li><a href="{{ path(pathlink,{'filter': 'WCM Pathology Principal Investigators of Research Labs'}) }}"> - WCM Pathology Principal Investigators of Research Labs</a></li>
            <li><a href="{{ path(pathlink,{'filter': 'WCM Pathology Faculty in Research Labs'}) }}"> - WCM Pathology Faculty in Research Labs</a></li>
        {% endif %}

        <hr style="margin-bottom:0; margin-top:0;">

        <li><a href="{{ path(pathlink,{'filter': 'WCM Pathology Staff'}) }}">WCM Pathology Staff</a></li>
        <li><a href="{{ path(pathlink,{'filter': 'NYP Pathology Staff'}) }}">NYP Pathology Staff</a></li>

        {% if not hasRoleSimpleView %}
            <li><a href="{{ path(pathlink,{'filter': 'WCM or NYP Pathology Staff in Research Labs'}) }}"> - WCM or NYP Pathology Staff in Research Labs</a></li>
        {% endif %}

        <hr style="margin-bottom:0; margin-top:0;">

        <li><a href="{{ path(pathlink,{'filter': 'WCM Anatomic Pathology Faculty'}) }}">WCM Anatomic Pathology Faculty</a></li>
        <li><a href="{{ path(pathlink,{'filter': 'WCM Laboratory Medicine Faculty'}) }}">WCM Laboratory Medicine Faculty</a></li>

        <hr style="margin-bottom:0; margin-top:0;">

        <li><a href="{{ path(pathlink,{'filter': 'WCM or NYP Pathology Residents'}) }}">WCM or NYP Pathology Residents</a></li>

        {% if not hasRoleSimpleView %}
            <li><a href="{{ path(pathlink,{'filter': 'WCM or NYP AP/CP Residents'}) }}"> - WCM or NYP AP/CP Residents</a></li>
            <li><a href="{{ path(pathlink,{'filter': 'WCM or NYP AP Residents'}) }}"> - WCM or NYP AP Residents</a></li>
            <li><a href="{{ path(pathlink,{'filter': 'WCM or NYP AP Only Residents'}) }}"> - WCM or NYP AP Only Residents</a></li>
            <li><a href="{{ path(pathlink,{'filter': 'WCM or NYP CP Residents'}) }}"> - WCM or NYP CP Residents</a></li>
            <li><a href="{{ path(pathlink,{'filter': 'WCM or NYP CP Only Residents'}) }}"> - WCM or NYP CP Only Residents</a></li>
        {% endif %}

        <li><a href="{{ path(pathlink,{'filter': 'WCM or NYP Pathology Fellows'}) }}">WCM or NYP Pathology Fellows</a></li>
        <li><a href="{{ path(pathlink,{'filter': 'WCM Non-academic Faculty'}) }}">WCM Non-academic Faculty</a></li>

        {% if pathlink_loc is defined and pathlink_loc %}
            <hr style="margin-bottom:0; margin-top:0;">
            <li><a href="{{ path(pathlink_loc,{'filter': 'Common Locations'}) }}">Common Locations</a></li>
            {% if not hasRoleSimpleView %}
                <li><a href="{{ path(pathlink_loc,{'filter': 'WCM & NYP Pathology Common Locations'}) }}">WCM & NYP Pathology Common Locations</a></li>
                <li><a href="{{ path(pathlink_loc,{'filter': 'WCM Pathology Common Locations'}) }}">WCM Pathology Common Locations</a></li>
                <li><a href="{{ path(pathlink_loc,{'filter': 'NYP Pathology Common Locations'}) }}">NYP Pathology Common Locations</a></li>
            {% endif %}
        {% endif %}

    </ul>
{% endmacro %}

{% import _self as usernavbar %}

{% block navbar %}

    {% set pendingadminreview = render(controller("OlegUserdirectoryBundle:User:pendingAdminReview")) %}

    {% set hasRoleSimpleView = app.security.getToken().getUser().hasRole('ROLE_USERDIRECTORY_EDITOR_SIMPLEVIEW') %}

    <nav class="navbar navbar-default" role="navigation">

    <div class="container-fluid">

        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            {% if is_granted('ROLE_USERDIRECTORY_OBSERVER') %}
                <a class="navbar-brand visible-xs visible-sm" href="{{ path(employees_sitename~'_home') }}">Home</a> <!-- this is for mobile devices - top menu -->
            {% endif %}
        </div>


        <div class="collapse navbar-collapse navbar-ex1-collapse" style="max-height:none;">


            {% if is_granted('ROLE_USERDIRECTORY_OBSERVER') %}

                <ul class="nav navbar-nav navbar-left">

                    {% import "OlegUserdirectoryBundle::Default/usermacros.html.twig" as usermacros %}
                    {{ usermacros.siteSwitch() }}

                    {% if minimum is not defined %}

                        <li id="nav-bar-userhome" class="hidden-xs divider-vertical">
                            <a href="{{ path(employees_sitename~'_home') }}">
                                <img src="{{ asset('bundles/oleguserdirectory/form/img/users-1-64x64.png') }}" alt="Employee Directory" height="18" width="18">
                                Home
                            </a>
                        </li>

                        <li id="nav-bar-userlist" class="dropdown">
                            {% if pendingadminreview is defined and pendingadminreview > 0 %}
                                <a id="incoming-orders-menu-title" href="#" class="dropdown-toggle" data-toggle="dropdown">List Current<b class="caret"></b></a><!--
                                            --><a id="incoming-orders-menu-badge"
                                                  class="element-with-tooltip-always"
                                                  title="Pending Administrative Review"
                                                  data-toggle="tooltip"
                                                  data-placement="bottom"
                                                  href="{{ path(employees_sitename~'_listusers',{'filter': 'Pending Administrative Review'}) }}"
                                                ><span class="badge">{{ pendingadminreview }}</span></a>
                            {% else %}
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">List Current<b class="caret"></b></a>
                            {% endif %}
                            {{ usernavbar.listUsers(employees_sitename~'_listusers',employees_sitename~'_list_common_locations',hasRoleSimpleView) }}
                        </li>

                        {% if is_granted('ROLE_USERDIRECTORY_EDITOR') and not hasRoleSimpleView %}
                            <li id="nav-bar-userlist-previous" class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">List Previous<b class="caret"></b></a>
                                {{ usernavbar.listUsers(employees_sitename~'_listusers_previous',null,hasRoleSimpleView) }}
                            </li>
                        {% endif %}

                        {% if is_granted('ROLE_USERDIRECTORY_EDITOR') %}
                            <li id="nav-bar-add" class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Add<b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    <li id="nav-bar-adduser" class="divider-vertical"><a href="{{ path(employees_sitename~'_new_user') }}">Employee</a></li>
                                    <li id="nav-bar-addlocation" class="divider-vertical"><a href="{{ path(employees_sitename~'_locations_pathaction_new_standalone') }}">Location</a></li>
                                </ul>
                            </li>
                        {% endif %}

                        <li id="nav-bar-userlist-download-excel"><a href="{{ path(employees_sitename~'_userlist_download_excel') }}">Download</a></li>

                    {% endif %}

                </ul>

            {% endif %}

           

            <ul class="nav navbar-nav navbar-right">

                {% if minimum is not defined %}

                    {#Search in navbar#}
                    {% if is_granted('ROLE_USERDIRECTORY_OBSERVER') %}
                        {% if urltype is not defined or urltype != "home" %}
                            <li id="nav-bar-usersearch">
                            {#Search for a name, service, division, etc#}
                            {% if search is not defined %}
                                {% set search = "" %}
                            {% endif %}
                            <div>
                            <form class="navbar-form navbar-left user-typeahead-search-form" role="search" id="navbar-user-typeahead-search-form" name="usertypeaheadsearchform" action="{{ path(employees_sitename~'_home') }}" method="get">
                                <div class="form-group">
                                    <div id="navbar-multiple-datasets-typeahead-search" class="multiple-datasets-typeahead-search">

                                        {#version 1: input field and button separated by white space#}
                                        {#<input#}
                                            {#type="text"#}
                                            {#class="typeahead submit-on-enter-field form-control"#}
                                            {#name="search" value="{{ search }}"#}
                                            {#placeholder="Search"#}
                                            {#style="font-size: 14px !important;"#}
                                            {#>#}

                                        {#version 2: input field has attached button, but button has bigger height => bad#}
                                        {#<div class="input-group">#}
                                            {#<input#}
                                                {#type="text"#}
                                                {#class="typeahead submit-on-enter-field form-control"#}
                                                {#name="search" value="{{ search }}"#}
                                                {#placeholder="Search"#}
                                                {#style="font-size: 14px !important;"#}
                                            {#/>#}
                                            {#<span class="input-group-addon btn btn-default btn-xs" onclick="document.usertypeaheadsearchform.submit();">#}
                                                {#<i class="glyphicon glyphicon-search"></i>#}
                                            {#</span>#}
                                        {#</div>#}

                                        {#version 3: input field has inside button#}
                                        <div class="form-group-typeahead">
                                            <div class="form-group has-feedback">
                                                <input
                                                        type="text"
                                                        class="typeahead submit-on-enter-field form-control"
                                                        name="search" value="{{ search }}"
                                                        placeholder="Search"
                                                        style="font-size: 14px !important;"
                                                        aria-describedby="inputSuccess2Status">
                                                <span style="top:0;" class="glyphicon glyphicon-search form-control-feedback btn" onclick="document.usertypeaheadsearchform.submit();" aria-hidden="true"></span>
                                                <span id="inputSuccess2Status" class="sr-only">(success)</span>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                {#version 1: input field and button separated by white space#}
                                {#<button type="button" class="btn btn-default">#}
                                    {#<span class="glyphicon glyphicon-search"></span>#}
                                {#</button>#}
                                {#<button type="submit" class="btn btn-default">Search</button>#}
                            </form>
                            </div>
                            </li>
                        {% endif %}
                    {% endif %}

                    {% if is_granted('ROLE_USERDIRECTORY_EDITOR') %}

                        <li id="nav-bar-admin" class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin<b class="caret"></b></a>
                            <ul class="dropdown-menu">

                                <li><a href="{{ path(employees_sitename~'_accessrequest_list') }}">Access Requests</a></li>
                                <li><a href="{{ path(employees_sitename~'_authorized_users') }}">Authorized Users</a></li>

                                {% if is_granted('ROLE_USERDIRECTORY_ADMIN') %}
                                    <li class="divider"></li>
                                    {#<li><a href="{{ path(employees_sitename~'_listusers') }}">Users</a></li>#}
                                    <li><a href="{{ path('user_admin_index') }}">List Manager</a></li>
                                    <li><a href="{{ path('platformlistmanager-list') }}">Platform List Manager</a></li>
                                    <li><a href="{{ path('user_admin_hierarchy_index') }}">Hierarchy Manager</a></li>
                                    <li><a href="{{ path(employees_sitename~'_logger') }}">Event Log</a></li>
                                {% endif %}

                                {% if is_granted('ROLE_PLATFORM_DEPUTY_ADMIN') %}
                                    <hr>
                                    <li><a href="{{ path(employees_sitename~'_import_users_excel') }}">Import Users</a></li>
                                    <li><a href="{{ path(employees_sitename~'_siteparameters') }}">Site Settings</a></li>
                                    <li><a
                                            general-data-confirm="Are you sure you would like to cleare cahce and update assets? This action will logout all authenticated users."
                                            href="{{ path('user_update_system_cache_assets') }}">Update System's Cache and Assets</a>
                                    </li>
                                {% endif %}

                            </ul>
                        </li>

                    {% endif %}

                {% endif %}

                {% if is_granted('ROLE_USER') %}

                    <li id="nav-bar-user" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-user"></span><b class="caret"></b></a>
                        <ul class="dropdown-menu">

                            {% if pendinguser is not defined %}
                                <li><a href="{{ path(employees_sitename~'_showuser', {id:app.security.getToken().getUser().getId()}) }}">My Profile ({{ app.security.getToken().getUser().getUserNameShortStr() }})</a></li>
                            {% endif %}

                            {% if pendinguser is not defined %}
                                <li><a href="{{ path(employees_sitename~'_about_page') }}">About</a></li>
                            {% endif %}

                            <li><a href="{{ path(employees_sitename~'_logout') }}">Log Out</a></li>

                        </ul>
                    </li>

                {% endif %}

            </ul>


        </div><!-- /.navbar-collapse -->

    </div><!-- /.container-fluid -->

    </nav>
    
{% endblock %}

