{% extends "OlegUserdirectoryBundle::Default/base.html.twig" %}
{% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}

{% block title %}
    Profile
{% endblock %}

{% block content %}

{#<form action="{{ path('user_update',{'id':entity.id}) }}" method="PUT" {{ form_enctype(form) }}>#}
{{ form_start(form) }}

    <input type="hidden" id="user_id" value="{{ user_id }}" />
    <input type="hidden" id="user_name" value="{{ form.vars.value.username }}" />
    <input type="hidden" id="formcicle" value="edit_user" />
    <input type="hidden" id="baseurl" value="{{app.request.host}}{{app.request.getBaseURL()}}" />

    <h3 class="text-info">User Info</h3>

    {#{{ form_widget(form) }}#}
    {{ form_errors(form) }}

    {{ formmacros.field(form.username) }}

    {{ formmacros.field(form.email) }}

    {#{{ formmacros.field(form.pathologyServices) }}#}
    {#{{ formmacros.field(form.defaultPathService) }}#}

    {% if cicle == "show_user" or is_granted('ROLE_SCANORDER_ADMIN') %}
        {{ formmacros.field(form.institution) }}
        {#{{ formmacros.field(form.service) }}#}
        {{ formmacros.field(form.roles) }}
    {% endif %}

    {#{{ formmacros.field(form.chiefservices) }}#}

    {{ formmacros.field(form.displayName) }}
    {{ formmacros.field(form.firstName) }}
    {{ formmacros.field(form.middleName) }}
    {{ formmacros.field(form.lastName) }}

    {% if is_granted('ROLE_SCANORDER_ADMIN') %}
        {% if app.security.getToken().getUser().getId() != entity.id %}
            {{ formmacros.checkbox(form.locked) }}
        {% else %}
            {% do form.locked.setRendered %}
        {% endif %}
    {% endif %}

    <hr>
    <h3 class="text-info">User Preferences</h3>
    {{ formmacros.field(form.preferences.timezone) }}
    {{ formmacros.checkbox(form.preferences.tooltip) }}
    <hr>

    <hr>
    <h3 class="text-info">Administrative Titles</h3>
    {% for administrativeTitle in form.administrativeTitles %}
        {{ formmacros.field(administrativeTitle.name) }}
        {{ formmacros.field(administrativeTitle.startDate) }}
        {{ formmacros.field(administrativeTitle.endDate) }}

        {#{{ formmacros.field(administrativeTitle.institution) }}#}
        {#{{ formmacros.field(administrativeTitle.department) }}#}
        {#{{ formmacros.field(administrativeTitle.division) }}#}
        {#{{ formmacros.field(administrativeTitle.service) }}#}

    {% endfor %}
    <hr>

    <hr>
    <h3 class="text-info">Per Site Settings</h3>
    {% for perSiteSetting in form.perSiteSettings %}
        {{ formmacros.field(perSiteSetting.siteName) }}
        {{ formmacros.field(perSiteSetting.permittedInstitutionalPHIScope) }}
        {{ formmacros.field(perSiteSetting.scanOrdersServicesScope) }}
        {{ formmacros.field(perSiteSetting.chiefServices) }}
        {{ formmacros.field(perSiteSetting.defaultService) }}
    {% endfor %}
    <hr>

    {#{{ formmacros.field(form.phone) }}#}
    {#{{ formmacros.field(form.fax) }}#}
    {#{{ formmacros.field(form.office) }}#}

    <br>
    {#{{ form_rest(form) }}#}
    {#{{ form_widget(form._token) }}#}

    {#{{ form(form) }}#}

    {% if cicle != "show_user" %}
        <p>
            <div>
                <button class="btn btn-warning" name="btnSubmit" type="submit">Update</button>
                <a class="btn btn-info" href="{{ path('showuser',{id:entity.id}) }}" type='button'>Cancel</a>
            </div>
        </p>
    {% endif %}

{{ form_end(form) }}
{#</form>#}

    {% if cicle == "show_user" %}
        <p><a class="btn btn-success" href="{{ path('user_edit',{'id':entity.id}) }}">Edit</a></p>
    {% endif %}

    {% if is_granted('ROLE_SCANORDER_ADMIN') %}
        <br>
        <p>
            <a href="{{ path('listusers') }}">View the list of all users</a>
        </p>
    {% endif %}

{% endblock %}
