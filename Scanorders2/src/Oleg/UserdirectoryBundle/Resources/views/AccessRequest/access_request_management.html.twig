{#{% extends "OlegUserdirectoryBundle::Default/base.html.twig" %}#}

{% if sitename == 'employees' %}
    {% set extendStr = "OlegUserdirectoryBundle::Default/base.html.twig" %}
{% elseif sitename == 'fellapp' %}
    {% set extendStr = "OlegFellAppBundle::Default/base.html.twig" %}
{% elseif sitename == 'deidentifier' %}
    {% set extendStr = "OlegDeidentifierBundle::Default/base.html.twig" %}
{% elseif sitename == 'scan' %}
    {% set extendStr = "OlegOrderformBundle::Default/base.html.twig" %}
{% elseif sitename == 'vacreq' %}
    {% set extendStr = "OlegVacReqBundle::Default/base.html.twig" %}
{% elseif sitename == 'calllog' %}
    {% set extendStr = "OlegCallLogBundle::Default/base.html.twig" %}
{% endif %}

{% extends extendStr%}

{#This form is used for access request and authorization management#}

{% if accreq is defined %}
    {% if accreq.status == 0 %}
        {#STATUS_ACTIVE#}
        {% set titleStr = "This user has an active request to access the "~sitenamefull~" site. You can update the role and other details below." %}
    {% elseif accreq.status == 1 %}
        {#STATUS_DECLINED#}
        {% set titleStr = "This user has declined to request access to the "~sitenamefull~" site. You can update the role and other details below." %}
    {% elseif accreq.status == 2 %}
        {#STATUS_APPROVED#}
        {% set titleStr = "This user is already authorized to access the "~sitenamefull~" site. You can update the role and other details below." %}
    {% else %}
        {% set titleStr = "Specify role and accessible data for the user being authorized to access the "~sitenamefull %}
    {% endif %}
{% else %}
    {% set titleStr = "Specify role and accessible data for the user being authorized to access the "~sitenamefull %}
{% endif %}

{% block title %}
    {{ titleStr }}
{% endblock %}



{% block content %}

    {% import "OlegOrderformBundle::Default/formmacros.html.twig" as formmacros %}
    {% import "OlegUserdirectoryBundle::Default/userformmacros.html.twig" as userform %}

    <h3 class="text-info">
        {{ titleStr }}
    </h3>

    <br>

    {{ userform.snapshot_steve(entity,sitenameshowuser,'edit') }}

    <hr>

    {% if accreq is defined %}

        {{ formmacros.simplefield( "Request ID:", accreq.id, "", "disabled" ) }}
        {{ formmacros.simplefield( "Request Date:", accreq.createdate|date('Y-m-d H:i:s'), "", "disabled" ) }}
        {{ formmacros.simplefield( "Request Status:", accreq.getStatusStr|capitalize, "", "disabled" ) }}
        {#{{ formmacros.simplefield( "Full Name:", entity.getUsernameOptimal(), "", "disabled" ) }}#}
        {#{{ formmacros.simplefield( "User ID Type:", entity.keytype, "", "disabled" ) }}#}
        {#{{ formmacros.simplefield( "User ID:", entity.primaryPublicUserId, "", "disabled" ) }}#}
        {#{{ formmacros.simplefield( "Email:", entity.primaryPublicUserId, "", "disabled" ) }}#}
        {#{{ formmacros.simplefield( "Phone Number:", entity.preferredPhone, "", "disabled" ) }}#}
        {{ formmacros.simplefield( "Last Login:", entity.lastLogin|date('Y-m-d H:i'), "", "disabled" ) }}
        {{ formmacros.simplefield( "Status Updated On:", accreq.updatedate|date('Y-m-d H:i'), "", "disabled" ) }}

        {% set updatedby = '<a href="'~path(sitenameshowuser~'_showuser', { 'id': accreq.updatedby.id })~'">'~accreq.updatedby~'</a>' %}
        {{ formmacros.simplefield( "Status Updated By:", updatedby, "", "disabled" ) }}

        <hr>
    {% endif %}

    {% if accreq is defined %}
        {% set actionPath = path(sitename~'_accessrequest_management_submit',{'id':accreq.id}) %}
    {% else %}
        {% set actionPath = path(sitename~'_authorization_user_management_submit',{'id':entity.id}) %}
    {% endif %}


    <form id="accessrequest_management" action="{{ actionPath }}" method="POST">

        {#{% if routename == sitename~'_accessrequest_management' %}#}
            {#<div style="display: none">#}
                {#{{ formmacros.field(form.perSiteSettings.permittedInstitutionalPHIScope) }}#}
            {#</div>#}
        {#{% else %}#}
            {{ formmacros.field(form.perSiteSettings.permittedInstitutionalPHIScope) }}
        {#{% endif %}#}

        {{ formmacros.field(form.roles) }}

        {{ formmacros.checkbox(form.emailNotification) }}

        <hr>

        <br>

        <div class="row">

            {% if accreq is defined %}
                <div class="col-xs-6" align="right">
                    {#Approve#}
                    <button name="accessrequest-approve" type='submit' class="btn btn-info btn-sm">Update</button>
                </div>

                <div class="col-xs-6" align="left">
                    {#Deny#}
                    <button
                        name="accessrequest-decline" type='submit' class="btn btn-danger btn-sm"
                        onclick="return confirm('You are about to stop {{ entity }} from being able to log in and use the {{ sitenamefull }} site')"
                    >Revoke</button>
                </div>
            {% else %}

                {% set updateBtnName = "Authorize User's Access" %}
                {% if siteRoles|length > 0 %}
                    {% set updateBtnName = "Update" %}
                {% endif %}

                <div class="col-xs-6" align="right">
                    <button name="accessrequest-approve" type='submit' class="btn btn-info btn-sm">{{ updateBtnName }}</button>
                </div>

                <div class="col-xs-6" align="left">
                    <a class="btn btn-danger btn-sm" href="{{ path(sitename~'_authorized_users') }}">Cancel</a>
                </div>
            {% endif %}

        </div>

    </form>



{% endblock %}

{#Snapshot css#}
{% block additionalcss %}
    {% stylesheets
        'bundles/oleguserdirectory/form/css/steve-snapshot.css' filter='cssrewrite'
    %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}
