{#{% extends "OlegUserdirectoryBundle::Default/base.html.twig" %}#}

{% if sitename == 'employees' %}
    {% set extendStr = "OlegUserdirectoryBundle::Default/base.html.twig" %}
{% elseif sitename == 'fellapp' %}
    {% set extendStr = "OlegFellAppBundle::Default/base.html.twig" %}
{% elseif sitename == 'deidentifier' %}
    {% set extendStr = "OlegDeidentifierBundle::Default/base.html.twig" %}
{% elseif sitename == 'scan' %}
    {% set extendStr = "OlegOrderformBundle::Default/base.html.twig" %}
{% endif %}

{% extends extendStr%}

{% block title %}
    Authorized Users for {{ sitenamefull }}
{% endblock %}

{% block content %}

    <h3 class="text-info">Authorized Users for {{ sitenamefull }}</h3>

    <br>

    <table class="table table-hover table-condensed text-left">
        <thead>
        <tr>
            {#<th>{{ knp_pagination_sortable(users, 'User ID', 'user.id') }}</th>#}
            <th>{{ knp_pagination_sortable(users, 'Full Name', 'infos.displayName') }}</th>
            <th>{{ knp_pagination_sortable(users, 'User ID Type', 'keytype.name') }}</th>
            <th>{{ knp_pagination_sortable(users, 'User ID', 'user.primaryPublicUserId') }}</th>
            <th>{{ knp_pagination_sortable(users, 'Email', 'infos.email') }}</th>
            <th>{{ knp_pagination_sortable(users, 'Phone Number', 'infos.preferredPhone') }}</th>
            <th>{{ knp_pagination_sortable(users, 'Role(s)', 'user.roles') }}</th>
            <th>{{ knp_pagination_sortable(users, 'Last Login', 'user.lastLogin') }}</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody data-link="row" class="rowlink">
        {% for user in users %}

            <td>
                <a href="{{ path(sitenameshowuser~'_showuser', { 'id': user.id }) }}">{{ user }}</a>
            </td>
            <td>{{ user.keytype }}</td>
            <td>{{ user.primaryPublicUserId }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.preferredPhone }}</td>
            <td>
                {#TODO: use user repository to get roles for this site {{ oCatRepo.getProducts(category.id, location) }}#}
                {% for role in user.getSiteRoles(sitename) %}
                    {% if role != "ROLE_USER" %}
                        {#"{{ attribute(roles, role) }}"#}
                        "{{ role }}"
                    {% endif %}
                {% endfor %}
            </td>
            <td>{{ user.lastLogin|date('Y-m-d H:i') }}</td>


            <td class="rowlink-skip">

                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                        Action <span class="caret"></span>
                    </button>

                    <ul class="dropdown-menu dropdown-menu-right">

                        <li><a href="{{ path(sitenameshowuser~'_showuser', { 'id': user.id }) }}">View User Details</a></li>

                        <li class="divider"></li>

                        <li>
                            <a href="{{ path(sitename~'_accessrequest_management', { 'id': user.id }) }}">Authorization Management</a>
                        </li>

                        <li>
                            <a general-data-confirm="Are you sure you want to remove access authorization from {{ user }}?"
                               href="{{ path(sitename~'_accessrequest_remove', { 'userId': user.id }) }}">Remove access authorization
                            </a>
                        </li>

                    </ul>

                </div>


            </td>

            </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="navigation">
        {{ knp_pagination_render(users) }}
    </div>

{% endblock %}
