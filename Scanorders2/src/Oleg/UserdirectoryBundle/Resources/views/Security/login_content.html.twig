{#
    Copyright 2017 Cornell University

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
#}

{% import "OlegUserdirectoryBundle::Default/usermacros.html.twig" as usermacros %}
{{ usermacros.nonLiveSiteWarning() }}
{{ usermacros.browserCheck() }}

<h2 class="alert alert-info well-lg safary-fix" align="center">{{ title }}</h2>

<br>

{% for flashMessage in app.session.flashbag.get('notice') %}
    <div class="flash-notice" align="center">
        {{ flashMessage|raw }}
    </div>
{% endfor %}

{% for flashMessage in app.session.flashbag.get('pnotify') %}
    <input type="hidden" id="pnotify-notice" value="{{ flashMessage|raw }}" />
{% endfor %}
{% for flashMessage in app.session.flashbag.get('pnotify-error') %}
    <input type="hidden" id="pnotify-notice" class="pnotify-notice-error" value="{{ flashMessage|raw }}" />
{% endfor %}
{% for flashMessage in app.session.flashbag.get('pnotify-success') %}
    <input type="hidden" id="pnotify-notice" class="pnotify-notice-success" value="{{ flashMessage|raw }}" />
{% endfor %}


{% if error is not defined %}
    {% set error = '' %}
{% endif %}

{% if last_username is not defined %}
    {% set last_username = '' %}
{% endif %}

{% if error %} 
    <p class="alert alert-danger" align="middle">
        {#{{ error }}<br>#}
        There was an error with your User Name/Password combination. Please try again.
    </p>
{% endif %}


<input type="hidden" name="display_height" id="display_height" value="" />
<input type="hidden" name="display_width" id="display_width" value="" />


<form id="login-form" class="form-signin" action="{{ path(sitename~'_login_check') }}" method="post">

    <div class="row">
    <div class="col-xs-12">

        <p>
            {#usernametype#}
            <select id="usernametypeid_show" class="combobox limit-font-size">
                {% for  usernametype in usernametypes %}
                    {% if user_type is defined and usernametype.name == user_type %}
                        {% set selected = 'selected="selected"' %}
                    {% else %}
                        {% set selected = '' %}
                    {% endif %}
                    <option value="{{ usernametype.abbreviation }}" {{ selected }}>{{ usernametype.name }}</option>
                {% endfor %}
            </select>

            {#display username field and hidden real fields using by security#}
            <input type="text" id="username" name="_username" value="{{ last_username }}" class="form-control limit-font-size" placeholder="Username Hidden" style="display:none;">
            <input type="text" id="display-username" value="{{ last_username }}" class="form-control limit-font-size" placeholder="Username" style="{{ inputStyle }}">

            <input type="password" id="password" name="_password" class="form-control limit-font-size" placeholder="Password" style="{{ inputStyle }}">

            {#<input type="checkbox" id="remember_me" name="_remember_me" checked />#}
            {#<label for="remember_me">Keep me logged in</label>#}

        </p>

    </div>
    </div>

    <button class="btn btn-lg btn-primary btn-block" type="submit" >Log In</button>

</form>


<div class="text-center">

    <br><br>
    <p>
        {% set loginInstruction = user_security_utility.getSiteSettingParameter('loginInstruction') %}
        {% if loginInstruction %}
            {{ loginInstruction|raw }}
        {% else %}
            Please use your
            <a href="http://weill.cornell.edu/its/identity-security/identity/cwid/">CWID</a>
            {% if title == "Scan Orders" %}
                or your
                <a href="http://c.med.cornell.edu/">Aperio eSlide Manager</a> account
            {% endif %}
            to log in.
        {% endif %}
    </p>

    {#{% if title == "Scan Orders" %}#}
        {#<p>#}
            {#<a href="{{ path('accountrequest_new') }}">Request an Aperio eSlide Manager account</a> if you can't log in.#}
        {#</p>#}
    {#{% endif %}#}
    {#{% if title == "HemePath Translational Research" %}#}
        <p>
            <a href="{{ path(employees_sitename~'_accountrequest_new') }}">Request a new account</a> if you can't log in.
        </p>
    {#{% endif %}#}

</div>


<script language="Javascript">
    <!--
        //console.log("width="+screen.width+"x"+screen.height);
        document.getElementById("display_height").value = screen.height;
        document.getElementById("display_width").value = screen.width;
    //-->
</script>